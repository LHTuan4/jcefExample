var zmProfile={getHitCounter:function(){var a=zm("#zmprofile_viewcount").attr("data-url");a&&zm.getJSON(a,function(b){zm("#zmprofile_viewcount").text(zmString.formatNumber(b,".")).parent().css("visibility","")})},fixSizeWhenChangeTab:function(a){var c=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0);var b=zm("#zm_header").outerWidth(false)+zm("#zm_footer").outerWidth(false);var d=zm("#zm_header").outerHeight(false)+zm("#zm_footer").outerHeight(false);zm("#profiletab_content").css("min-height",(e-d)+"px");if(zm(".prf_navbar").hasClass("sticked")&&!a){zmCommon.scrollTo(zm(".pfctncover").offset(true).top+zm(".pfctncover").outerHeight(true)-zm(".prf_navbar").outerHeight(true))}},getFormData:function(d){var c={};var b=document.getElementById(d);if(!b){return c}var a=b.elements;zm.each(a,function(){if(this.type==="button"||this.type==="reset"||this.type==="submit"){return}if(this.type==="radio"||this.type==="checkbox"){if(this.checked){c[this.name]=this.value}}else{c[this.name]=this.value||""}});return c},boxy:{},icon:{},countCateCMS:0};var zmFanpageInvite=(function(){var a={};a.cacheData={};a.renderData={};a.renderLoadMore=function(){if(a.renderData.loading){return'<p class="zmloading"><em></em></p>'}if(!a.renderData.showPickedFriend&&a.renderData.renderLoadMore&&!(a.cacheSize>=a.cacheFriends)){return'<a href="#" id="boxy_loadmore" class="feed_loadmorebar" onclick="return zmFanpageInvite.handerLoadmore()">                        <span class="zmicn16"></span>Xem thêm</a>'}else{return'<a href="#" style="visibility:hidden" id="boxy_loadmore" class="feed_loadmorebar" onclick="return zmAppSendInvite.handerLoadmore()">                        <span class="zmicn16"></span>Xem thêm</a>'}};a.hideLoadMore=function(){zm("a#boxy_loadmore").css("visibility","hidden")};a.showLoadMore=function(){if(a.renderData.renderLoadMore&&!(a.cacheSize>=a.cacheFriends)){zm("a#boxy_loadmore").css("visibility","visible")}};a.handerLoadmore=function(){a.cacheSize+=15;a.setScroll(a.renderFriendList(a.cacheFriends));if(a.cacheSize>=a.cacheFriends.length){a.renderData.renderLoadMore=false;a.hideLoadMore()}zwg.fillWg();return false};a.refresh=function(){a.boxy.setContent(a.renderContent());a.setScroll(a.renderFriendList(a.cacheFriends));a.boxy.center();zwg.fillWg()};a.renderContent=function(b){var e=a.renderData.friends;var d=new zm.Template('<div class="quiksrchfrd_toshare">                    <div class="selcount">                      <p>Đang chọn <strong id="chosing_strong"> {0} / {1} </strong> bạn</p>                      <p>                        <input type="checkbox" name="radiolist" id="showPickedFriend" value="{5}">                        <label onclick="zmFanpageInvite.showPickedFriendHandle()" ><span class="checkbox"></span>Xem chọn</label>                      </p>                    </div>                    <p class="srchborder btn_searchfrd"> <span class="btn_ico"></span> <span class="qiksrch_textinput">                      <input type="text" onkeyup="zmFanpageInvite.editFilterInput1()"  onpaste="zmFanpageInvite.editFilterInput2()"                              value="{4}" oninput="zmFanpageInvite.editFilterInput()" id="friendFilter" class="textinput" placeholder="Nhập tên bạn bè">                      </span> </p>                </div>                <div class="frd_for_sharing clearfix" id="renderListInviteFriend">                        {2}                </div>                  {3}                <div class="clr"></div>');var c;if(!b){if(e){c=d.render(a.renderData.selected,a.renderData.numberOfFriends,"",a.renderLoadMore(),a.renderData.filterString,a.renderData.showPickedFriend,a.renderData.inviteMessage)}else{c=d.render(0,0,'<p class="zmloading64"><em></em><span>Đang tải dữ liệu...</span></p>',a.renderLoadMore(),"",a.renderData.inviteMessage)}}else{c=d.render(0,0,"Có lỗi xảy ra, xin vui lòng thử lại!",a.renderLoadMore(),"",a.renderData.inviteMessage)}return c};a.renderAvatar=function(b){if(b.avatarLarge){}};a.messageHandle=function(){a.renderData.inviteMessage=zm("#inviteMessage").val()};a.showPickedFriendHandle=function(){if(a.renderData.showPickedFriend){a.renderData.showPickedFriend=false}else{a.renderData.showPickedFriend=true}a.refresh();var b=document.getElementById("showPickedFriend");b.checked=a.renderData.showPickedFriend};a.editFilterInput=function(){zwg.fillWg();if(a.renderData.filterString===zm("#friendFilter").val()){return}a.renderData.filterString=zm("#friendFilter").val();zm("#renderListInviteFriend").html("");a.setScroll(a.renderFriendList([],a.renderSearchList()));zwg.fillWg()};a.editFilterInput1=function(){if(a.renderData.filterString===zm("#friendFilter").val()){return}a.renderData.filterString=zm("#friendFilter").val();zm("#renderListInviteFriend").html("");a.setScroll(a.renderFriendList([],a.renderSearchList()));zwg.fillWg()};a.editFilterInput2=function(){if(a.renderData.filterString===zm("#friendFilter").val()){return}a.renderData.filterString=zm("#friendFilter").val();zm("#renderListInviteFriend").html("");a.setScroll(a.renderFriendList([],a.renderSearchList()));zwg.fillWg()};a.renderFriendList=function(f,d){var c=new zm.Template('<ul id="inviteFriendUl"> {0} {1} </ul>');var h="";if(!f){return c.render("")}var g;if(a.renderData.showPickedFriend){g=f.filter(function(i){return i.selected})}else{g=f.filter(a.filterFunction)}for(var b=0;(b<g.length)&&(b<a.cacheSize);b++){var e=g[b];h+=a.renderSearchItem(e,f.indexOf(e));zwg.addItem("zAI_"+e.userId,"ZMEA_"+e.userId+"?id=1&l=1&size=120&width=120&height=120")}return c.render(h,d)};a.renderFriendItem=function(f,b){var e="";if(f.selected){e="selected"}var d=new zm.Template('<li>                     <a class="{3}" href="/u/{0}" title="{2}" onclick="zmFanpageInvite.handerChoseFriend(this,{4}); return false;">                         <span class="checkmark zmicn"></span>                        <span class="overlap"></span>                        <span class="avt">                            <img src="{1}" alt="{2}">                        </span> <strong class="username">{2}</strong>                    </a>                </li>');var c=d.render(f.userName,f.avatarLarge,f.fullName,e,b);return c};a.cacheFriendFilter=function(c){var b=a.renderData.filterString;if(!b){return true}if(c.fullName.toLowerCase().indexOf(b.toLowerCase())>=0||(c.userName.toLowerCase().indexOf(b.toLowerCase())>=0)){return true}return false};a.renderSearchList=function(){var e;if(!a.renderData.filterString){e=a.cacheFriends;a.showLoadMore()}else{e=a.cacheFriends.filter(a.cacheFriendFilter);a.hideLoadMore()}var d="";for(var c=0;c<e.length;c++){var f=e[c];var b=a.cacheFriends.indexOf(f);d+=a.renderSearchItem(f,b);zwg.addItem("zAI_"+f.userId,"ZMEA_"+f.userId+"?id=1&l=1&size=120&width=120&height=120")}return d};a.renderSearchItem=function(e,b){var c=new zm.Template('<li>                     <a class="{4}" href="/u/{0}" title="{1}" onclick="zmFanpageInvite.handerChoseFriendCache(this, {3}); return false;">                         <span class="checkmark zmicn"></span>                        <span class="overlap"></span>                        <span class="avt" id="zAI_{2}">                        </span> <strong class="username">{1}</strong>                    </a>                </li>');var d="";if(e.selected){d="selected"}return c.render(e.userName,e.fullName,e.userId,b,d)};a.handerChoseFriendCache=function(b,c){var d=zm(b);if(d.hasClass("selected")){d.removeClass("selected");a.renderData.selected--;a.cacheFriends[c].selected=false}else{a.cacheFriends[c].selected=true;d.addClass("selected");a.renderData.selected++}zm("#chosing_strong").html(" "+a.renderData.selected+"/"+a.renderData.numberOfFriends+" ")};a.filterFunction=function(c){var b=a.renderData.filterString;if(!b){return true}if(c.userName.toLowerCase().indexOf(b.toLowerCase())>=0||(c.fullName.toLowerCase().indexOf(b.toLowerCase())>=0)){return true}return false};a.handerChoseFriend=function(b,c){var e=a.renderData.friends[c];var d=zm(b);if(e.selected){e.selected=false;a.renderData.selected--;d.removeClass("selected")}else{e.selected=true;a.renderData.selected++;d.addClass("selected")}zm("#chosing_strong").html(" "+a.renderData.selected+"/"+a.renderData.numberOfFriends+" ");return false};a.show=function(){if(zmConfig.viewerId<=0){return}if(!a.initiated){zmFanpageInvite.init()}if(zmCacheFriends){a.renderData.friends=[];a.renderData.numberOfFriends=zmCacheFriends.length;if(a.renderData.numberOfFriends>14){a.renderData.renderLoadMore=true}else{a.renderData.renderLoadMore=false}a.refresh()}else{a.boxy.setContent(a.renderContent(true))}a.boxy.show()};a.sendInvite=function(){var b={ts:zmConfig.time,sign:zmConfig.token};for(var d=0;d<a.cacheFriends.length;d++){var e=a.cacheFriends[d];if(e.selected){if(!b.ids){b.ids=e.userId}else{b.ids+=","+e.userId}}}var c="/v/"+zmConfig.ownerName+"/intro";zm.post(c,b,{dataType:"json"},function(f){if(f.error===0){zm.Boxy.alert("Lời mời đã được gửi thành công!","Thông báo",3000)}else{zm.Boxy.alert("Có lỗi xảy ra xin vui lòng thử lại","Thông báo",3000)}})};a.setScroll=function(b){a.scrollInstance.setContent(b);a.scrollInstance.appendTo(zm("#renderListInviteFriend"))};a.init=function(){a.initiated=true;var e={};e.title="Chia sẻ đến bạn bè";e.titleIcon=true;e.boxyClass="pu_larger pu_sharedtofriend";e.modal=true;e.okButton="Chia sẻ";e.cancelButton="Hủy bỏ";e.cancelClass="cancelbtn zmbtndefault";e.okClass="submitbtn zmbtn2";e.content=a.renderContent();e.onOk=a.sendInvite;a.renderData={};a.renderData.selected=0;a.renderData.loadedPage=1;a.boxy=new zm.Boxy(e);a.cacheFriends=new Array();var g;if(!zmCacheFriends){g=[];a.initiated=false}else{g=zmCacheFriends}var c=JSON.parse(JSON.stringify(g));for(var d=0;d<c.length;d++){var f=c[d];var b={};b.userId=f[0];b.userName=f[1];b.fullName=f[2];a.cacheFriends.push(b)}a.cacheSize=15;a.renderData.showPickedFriend=false;a.scrollInstance=new zm.ScrollableUI({content:"",width:633,height:429})};return a})();var zmFanPageAdmin=(function(){function h(B,C){var A="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putvideo";zmCore.post(A,B,{dataType:"json"},C)}function m(B,C){var A="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=removevideo";zmCore.post(A,B,{dataType:"json"},C)}function s(B,C){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=getvideo";zmCore.post(A,{id:B},{dataType:"json"},C)}function i(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=getserver";zmCore.post(A,{idFanPage:zmConfig.ownerId},{dataType:"json"},B)}function o(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=navitemcms";zmCore.post(A,{},{dataType:"json"},B)}function a(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=listitemcms";zmCore.post(A,{},{dataType:"json"},B)}function l(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=newitem";zmCore.post(A,{},{dataType:"json"},B)}function j(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=newcate";zmCore.post(A,{},{dataType:"json"},B)}function y(C,B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=edititem";zmCore.post(A,{id:C},{dataType:"json"},B)}function f(B,C){var A="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putitemcms";zmCore.post(A,B,{dataType:"json"},C)}function r(B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=getmp3";zmCore.post(A,{},{dataType:"json"},B)}function x(C,B){var A="/v/"+zmConfig.ownerName+"/boxfanpage?action=getabout";zmCore.post(A,{id:C},{dataType:"json"},B)}function e(B,C){var A="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putabout";zmCore.post(A,B,{dataType:"json"},C)}function d(B,C){var A="/prest/"+zmConfig.ownerName+"/save?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&box=about";zmCore.post(A,B,{dataType:"json"},C)}function u(){zm("#list_item").remove();zm("#new_cate").remove();zm("#new_item").remove();zm("#edit_item").remove();zm("#add_new_cate").remove();zm("#nav_itemCMS ul li a").removeClass("selected");zm(".addcate_row").remove();zmFanPageAdminHandle.data.categoryFormNumber=0}function t(){var C=zm(".fpbtn_preview").find(".fp_funcbtn");var E=C.attr("class");var F=E.split(" ");var A=zm("#btn_type").val();var G="";for(var D=0;D<F.length;D++){var B=F[D].trim();if(B.length>0){C.removeClass(B);if(B.indexOf("btn_st")!=-1){B=B.substr(0,B.length-1)+A}G+=B+" "}}C.addClass(G)}function v(A,E,D,C){var B=0;zm("#"+A).click(function(F){F.preventDefault();if(B==0){zm("#"+E).css("display","block");B=1}else{zm("#"+E).css("display","none");B=0}zm("#"+E+" .btnico_list li").click(function(I){zm("#"+C).attr("checked",false);zm(".btnico_list li").removeClass("selected");var H={};var G=this.nodeName.toLowerCase();if(G=="li"){H.li=zm(this)}else{if(G=="span"){H.li=zm(this).parent()}}H.selectedIcon=A;H.btn=D;g(H);return false});zm("#"+C).click(function(){var G=zm("#"+C).attr("checked");if(G){zm(".btnico_list li").removeClass("selected");zm("#"+A).find("span").attr("class","").addClass("btnico");zm("#"+A).addClass("no_icon");zm("#"+D).addClass("no_ico")}})});zm("#"+A).clickOutside(function(){zm("#"+E).css("display","none");B=0});zm("#"+A).clickOutsideWith(zm("#"+E))}function g(E){var A=E.li;var D=E.selectedIcon;var C=E.btn;A.addClass("selected");var B=A.find("span").attr("class");zm("#"+D).removeClass("no_icon");zm("#"+D).find("span").attr("class","").addClass(B);zm("#"+C).removeClass("no_ico");zm("#"+C).find("span").attr("class","").addClass(B)}function c(B,A,C){zm("#"+B).keyup(function(){b(B,A,C)});zm("#"+B).blur(function(){b(intput,A,C)})}function b(B,A,C){switch(C){case 1:var D="<em>"+zm("#"+A).find("em").html()+"</em>";var E=zm("#"+B).val().trim();zm("#"+A).html(D+E);break;case 2:var E=zm("#"+B).val().trim();zm("#"+A).attr("href",E);break}}function n(A){zm("#"+A).change(function(){var D=0;var K=zm("#btn1_status").val(),J=zm("#btn2_status").val(),I=zm("#btn3_status").val(),B=zm(".fpbtn_preview_area .fp_funcbtn"),H=B.find("li.fpbtn01"),F=B.find("li.fpbtn02"),E=B.find("li.fpbtn03"),G=B.children();if(K==1){D++;H.css("display","block")}else{H.css("display","none")}if(J==1){D++;F.css("display","block")}else{F.css("display","none")}if(I==1){D++;E.css("display","block")}else{E.css("display","none")}switch(D){case 0:G.css("display","none");var C='<div id="empty_msg" class="empty_msg text_primary text_center">Bạn không sử dụng nút chức năng nào</div>';B.append(C);break;case 1:G.css("display","block");zm("#empty_msg").remove();B.removeClass("two_btn").addClass("single_btn");break;case 2:B.removeClass("single_btn").addClass("two_btn");break;case 3:B.removeClass("two_btn").removeClass("single_btn");break}})}function k(C,A){var B={};var D=0;if(C>0){D=C}if(!zmProfile.boxy.clip){zmProfile.boxy.clip=new zm.Boxy({title:"Cập nhật videoclip",content:A,boxyClass:"pu_larger pu_updatevideoclip",modal:true,okButton:"Cập nhật",okClass:"submitbtn zmbtn2",cancelButton:"Hủy bỏ",cancelClass:"cancelbtn zmbtndefault",onOk:function(){B.id=D;B.title=zm("#clip_title").val();B.linkVideo=zm("#clip_link").val();B.singer=zm("#clip_singer").val();if(B.title&&B.linkVideo&&B.singer&&B.linkVideo.indexOf("youtu")!=-1){h(B,function(E){if(!E){zmProfile.boxy.clip.showErrorMessage("Có lỗi xảy ra")}else{if(E.error>=0){zmProfile.boxy.clip.showSuccessMessage(E.data);setTimeout(function(){window.location.reload()},1000)}else{zmProfile.boxy.clip.showErrorMessage(E.data)}}})}else{zmProfile.boxy.clip.showErrorMessage("Nhập đầy đủ thông tin")}return false}});zmProfile.boxy.clip.center();zmProfile.boxy.clip.show();zm("#clip_link").blur(function(){var G=zm(this).val();if(!G||G.indexOf("youtu")==-1){zmProfile.boxy.clip.showErrorMessage("Đường dẫn phải là link youtube");return}if(G){if(G.indexOf("youtu.be/")!=-1){G=G.replace("youtu.be/","www.youtube.com/embed/")}if(G.indexOf("watch")!=-1){var H={};G.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(J,I,L,K){H[I]=K});var E=H.v;G="https://www.youtube.com/embed/"+E}var F='<iframe src="'+G+'" frameborder="0" allowfullscreen></iframe>';zm("#view_clip").html(F);zmProfile.boxy.clip.hideMessage()}});zm("#remove_clip").click(function(G){G.preventDefault();var E=confirm("Bạn thật sự muốn xóa video này?");if(E){var F={};F.id=zm("#remove_clip").attr("data_key");m(F,function(H){if(H&&H.error==0){zmProfile.boxy.clip.showSuccessMessage(H.data);zm("#view_clip").addClass("noclip");zm("#view_clip").html('<span class="zmicn vlcip_icon"></span>');zm("#clip_link").val("");zm("#clip_title").val("");zm("#clip_singer").val("");zm("#remove_clip").hide()}else{zmProfile.boxy.clip.showErrorMessage(H.data)}})}})}else{zmProfile.boxy.clip.show()}}function z(A){if(!zmProfile.boxy.server){zmProfile.boxy.server=new zm.Boxy({title:"Cập nhật máy chủ mới",content:A,boxyClass:"pu_larger pu_listserver",modal:true,footer:false,onClose:function(){window.location.reload()}});zmProfile.boxy.server.show();zmProfile.boxy.server.center()}else{zmProfile.boxy.server.show()}}function q(A){if(!zmProfile.boxy.itembox){zmProfile.boxy.itembox=new zm.Boxy({title:"Cập nhật bài viết",content:A,boxyClass:"pu_larger pu_updatearticle",onClose:function(){window.location.reload()},modal:true,footer:false});zmProfile.boxy.itembox.show();a(function(C){if(C&&C.error>=0){var B=C.data;zm("#nav_itemCMS").after(B);zmProfile.boxy.itembox.center();zm(".edit_item").click(function(D){zm("#edit_item").remove();D.preventDefault();var E=zm(this).attr("data-key");y(E,function(G){if(G&&G.error>=0){var F=G.data;zm("#nav_itemCMS").after(F);zm("#edit_item").find("div.return_action").hide();zmProfile.boxy.itembox.center()}})})}});zm("#listitem").click(function(C){C.preventDefault();u();zm(this).addClass("selected");var B={footer:false};zmProfile.boxy.itembox.changeSettings(B);a(function(E){if(E&&E.error>=0){var D=E.data;zm("#nav_itemCMS").after(D);zm(".edit_item").click(function(F){zm("#edit_item").remove();F.preventDefault();var G=zm(this).attr("data-key");y(G,function(I){if(I&&I.error>=0){var H=I.data;zm("#nav_itemCMS").after(H);zmProfile.boxy.itembox.center()}})})}})});zm("#newitem").click(function(C){C.preventDefault();u();zm(this).addClass("selected");var B={footer:true,okButton:"Cập nhật",okClass:"submitbtn zmbtn2",cancelButton:"Hủy bỏ",cancelClass:"cancelbtn zmbtndefault",onOk:function(){var D={};D.id=0;D.name=zm("#item_title").val();D.targetLink=zm("#item_targetLink").val();D.desc=zm("#item_desc").val();D.cateCMS=zm("#item_cate").val();D.highlights=zm("#item_highlight").is(":checked")?"1":"0";D.imgLink=zm("#item_imgLink").attr("src");if(D.name&&D.targetLink&&D.desc){f(D,function(E){if(!E){zmProfile.boxy.itembox.showErrorMessage("Có lỗi xảy ra")}else{if(E.error>=0){zmProfile.boxy.itembox.showSuccessMessage(E.data);setTimeout(function(){window.location.reload()},1000)}else{zmProfile.boxy.itembox.showErrorMessage(E.data)}}})}else{zmProfile.boxy.itembox.showErrorMessage("Nhập đầy đủ thông tin")}return false}};zmProfile.boxy.itembox.changeSettings(B);zmProfile.boxy.itembox.center();l(function(E){if(E&&E.error>=0){var D=E.data;zm("#nav_itemCMS").after(D);zmProfile.boxy.itembox.center()}});zmProfile.boxy.itembox.hideMessage();zmProfile.boxy.itembox.hideLoading()});zm("#newcate").click(function(C){C.preventDefault();u();zm(this).addClass("selected");var B={footer:false};zmProfile.boxy.itembox.changeSettings(B);j(function(E){if(E&&E.error>=0){var D=E.data;zm("#nav_itemCMS").after(D);zmProfile.countCateCMS=E.count;zmProfile.boxy.itembox.center()}})})}else{zmProfile.boxy.itembox.show()}}function w(A){if(!zmProfile.boxy.mp3){zmProfile.boxy.mp3=new zm.Boxy({title:"Cập nhật bài hát",content:A,boxyClass:"pu_larger pu_listserver pu_listsong",onClose:function(){window.location.reload()},modal:true,footer:false});zmProfile.boxy.mp3.center();zmProfile.boxy.mp3.show()}else{zmProfile.boxy.mp3.show()}}function p(A){if(!zmProfile.boxy.about){zmProfile.boxy.about=new zm.Boxy({title:"Cập nhật thông tin giới thiệu",content:A,boxyClass:"pu_large pu_fpfuncbtn",modal:true,okButton:"Cập nhật",okClass:"submitbtn zmbtn2",cancelButton:"Hủy bỏ",cancelClass:"cancelbtn zmbtndefault",onOk:function(){var E={},D={};D.st_about=zm(".fp_introcontent textarea").val();D.st_email="";E.id=0;E.btn_type=0;E.icon_btn1=0;E.icon_btn2=0;E.icon_btn3=0;E.status_btn1=0;E.status_btn2=0;E.status_btn3=0;E.label_btn1="";E.label_btn2="";E.label_btn3="";E.link_btn1="";E.link_btn2="";E.link_btn3="";var G=zm("#edit_about").attr("data-key");if(G&&G!=undefined){E.id=G}E.btn_type=zm("#btn_type").val();E.label_btn1=zm("#btn1_label").val();E.label_btn2=zm("#btn2_label").val();E.label_btn3=zm("#btn3_label").val();E.link_btn1=zm("#btn1_url").val();E.link_btn2=zm("#btn2_url").val();E.link_btn3=zm("#btn3_url").val();E.status_btn1=zm("#btn1_status").val();E.status_btn2=zm("#btn2_status").val();E.status_btn3=zm("#btn3_status").val();var F=zm("#selected_icon1 span").attr("class");var C=F.match(/btnico_[0-9]+/);if(C!=undefined&&C){E.icon_btn1=C[0].replace("btnico_","")}else{E.icon_btn1=0}F=zm("#selected_icon2 span").attr("class");C=F.match(/btnico_[0-9]+/);if(C!=undefined&&C){E.icon_btn2=C[0].replace("btnico_","")}else{E.icon_btn2=0}F=zm("#selected_icon3 span").attr("class");C=F.match(/btnico_[0-9]+/);if(C!=undefined&&C){E.icon_btn3=C[0].replace("btnico_","")}else{E.icon_btn3=0}var B=0;if(E.status_btn1>0){if(E.label_btn1.trim().length<=0){zm("#btn1_label").addClass("error");B++}if(E.link_btn1.trim().length<=0){zm("#btn1_url").addClass("error");B++}}if(E.status_btn2>0){if(E.label_btn2.trim().length<=0){zm("#btn2_label").addClass("error");B++}if(E.link_btn2.trim().length<=0){zm("#btn2_url").addClass("error");B++}}if(E.status_btn3>0){if(E.label_btn3.trim().length<=0){zm("#btn3_label").addClass("error");B++}if(E.link_btn3.trim().length<=0){zm("#btn3_url").addClass("error");B++}}if(B>0){zmProfile.boxy.about.showErrorMessage("Bạn phải nhập đầy đủ thông tin.");return false}e(E,function(H){if(!H){zmProfile.boxy.about.showErrorMessage("Có lỗi xảy ra")}else{if(H.error<0){zmProfile.boxy.about.showErrorMessage(H.data)}else{d(D,function(I){if(!I){zmProfile.boxy.about.showErrorMessage("Có lỗi xảy ra")}else{if(I.error<0){zmProfile.boxy.about.showErrorMessage(I.data)}else{zmProfile.boxy.about.showSuccessMessage(I.data);setTimeout(function(){window.location.reload()},3000)}}})}}});return false}});zmProfile.boxy.about.center();zmProfile.boxy.about.show();zm("#btn_type").change(function(){t()});v("selected_icon1","icon1_type","btn_1","btn1_noicon");v("selected_icon2","icon2_type","btn_2","btn2_noicon");v("selected_icon3","icon3_type","btn_3","btn3_noicon");c("btn1_label","btn_1",1);c("btn2_label","btn_2",1);c("btn3_label","btn_3",1);c("btn1_url","btn_1",2);c("btn2_url","btn_2",2);c("btn3_url","btn_3",2);n("btn1_status");n("btn2_status");n("btn3_status")}else{zmProfile.boxy.about.show()}}return{init:function(){zm("#edit_clip").click(function(A){A.preventDefault();if(zmProfile.boxy.clip){k()}else{var B=zm(this).attr("data-key");s(B,function(C){if(C&&C.error>=0){k(B,C.data)}})}});zm("#editServer").click(function(A){A.preventDefault();if(zmProfile.boxy.server){z()}else{i(function(B){if(B&&B.error>=0){z(B.data)}})}});zm(".edit_news").click(function(A){A.preventDefault();if(zmProfile.boxy.itemBox){q()}else{o(function(B){if(B&&B.error>=0){q(B.data)}})}});zm(".edit_gameguide").click(function(A){A.preventDefault();if(zmProfile.boxy.itemBox){q()}else{o(function(B){if(B&&B.error>=0){q(B.data)}})}});zm("#edit_mp3").click(function(A){A.preventDefault();if(zmProfile.boxy.mp3){w()}else{r(function(B){if(B&&B.error>=0){w(B.data)}})}});zm("#edit_about").click(function(A){A.preventDefault();if(zmProfile.boxy.about){p()}else{var B=zm(this).attr("data-key");x(B,function(C){if(C&&C.error>=0){p(C.data)}})}})}}})();var zmFanPageAdminHandle=(function(){var a={};a.timeRegex="(([0]?[0-5][0-9]|[0-9]):([0-5][0-9]))-((0?[1-9]|[12][1-9]|3[01]).(0?[13578]|1[02]).20[0-9]{2}|(0?[1-9]|[12][1-9]|30).(0?[13456789]|1[012]).20[0-9]{2}|(0?[1-9]|1[1-9]|2[0-8]).(0?[123456789]|1[012]).20[0-9]{2}|(0?[1-9]|[12][1-9]).(0?[123456789]|1[012]).20(00|04|08|12|16|20|24|28|32|36|40|44|48|52|56|60|64|68|72|76|80|84|88|92|96))";a.removeItem=function(c,d){};a.data={};a.data.server={};a.data.category={};a.data.mp3={};a.data.serverFormNumber=0;a.data.categoryFormNumber=0;a.data.mp3FormNumber=0;a.createXMLHttpRequest=function(){var c;if(window.AtiveXObject){c=new ActiveXObject("Microsoft.XMLHTTP")}else{c=new XMLHttpRequest()}return c};a.renderEditServerForm=function(d){var c=new zm.Template('<div class="col1 fl">                    <div class="formrow formrow_servname fl">                        <span class="form_element_wrapper">                            <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)"                                value="{0}" placeholder="Tên server" class="txt_servname" type="text">                        </span>                    </div>                    <div class="formrow fl formrow_servlink">                        <span class="form_element_wrapper">                            <input oninput="zmFanPageAdminHandle.addValidateClass(this,5)"                               value="{1}" placeholder="http://me.zing.vn/apps/" class="txt_servlink zm-validated" type="text">                        </span>                    </div>                </div>                <div class="col2 fl">                    <div class="formrow">                        <span class="form_element_wrapper">                            <input oninput="zmFanPageAdminHandle.addValidateClass(this,4)"                                 value="{2}" placeholder="hh:mm-dd.MM.yyyy" class="txt_servtime" type="text">                        </span>                    </div>                </div>                <div class="col3 fl">                    <div class="formrow">                        <span class="form_element_wrapper">                            <select class="selectbox">                                <option value="1">Đã mở</option>                                <option value="2">Sắp mở</option>                            </select>                        </span>                    </div>                </div>                <div class="col4 fl">                    <div class="formrow">                        <input class="zmbtn3" onclick="zmFanPageAdminHandle.saveEditServer(this, {3});  return false;" value="Xong" type="submit">                        <input style="display:none" class="zmbtn3" onclick="zmFanPageAdminHandle.revertChange(this, {3});  return false;" value="Cancel" type="submit">                    </div>                </div>');return c.render(d.serverName,d.link,d.openTime,d.serverId)};a.newServerTemplate=function(){var c=new zm.Template('<div class="addserver_row clearfix">                    <div class="col1 fl">                        <div class="formrow formrow_servname fl">                            <span class="form_element_wrapper">                                <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)"                                     type="text" placeholder="Tên server" class="txt_servname">                            </span>                        </div>                        <div class="formrow fl formrow_servlink">                            <span class="form_element_wrapper">                                <input oninput="zmFanPageAdminHandle.addValidateClass(this,5)"                                   placeholder="http://me.zing.vn/apps/" class="txt_servlink" type="text">                            </span>                        </div>                    </div>                    <div class="col2 fl">                        <div class="formrow">                            <span class="form_element_wrapper">                                <input oninput="zmFanPageAdminHandle.addValidateClass(this,4)" type="text" placeholder="hh:mm-dd.MM.yyyy" class="txt_servtime" pattern="{0}">                            </span>                        </div>                    </div>                    <div class="col3 fl">                        <div class="formrow">                            <span class="form_element_wrapper">                                <select class="selectbox">                                <option value="1">Đã mở</option>                                <option value="2">Sắp mở</option>                                </select>                            </span>                        </div>                    </div>                    <div class="col4 fl">                        <div class="formrow">                            <a onclick="zmFanPageAdminHandle.putNewServer(this); return false;" href="#" class="zmbtn2_block">Thêm</a>                        </div>                    </div>                </div>');return c.render(a.timeRegex)};a.displayServerTemplate=function(e){var d;if(parseInt(e.status)===1){d="Đã mở"}else{d="Sắp mở"}var c=new zm.Template('<li class="clearfix">                                    <div class="col1 fl">                                        <div class="form_element text_cutted">                                            <strong><a href="{1}">{0}</a></strong>                                        </div>                                    </div>                                    <div class="col2 fl">                                        <div class="form_element">{2}</div>                                    </div>                                    <div class="col3 fl">                                        <div class="formrow">                                        <div class="form_element text_cutted">{3}</div>                                        </div>                                    </div>                                    <div class="col4 fl">                                        <p class="article_control">                                            <a class="article_edit zmicn" href="#" title="Sửa" onclick="zmFanPageAdminHandle.editServer(this, {4});return false;"></a>                                            <a class="article_del zmicn" href="#" title="Xóa" onclick="zmFanPageAdminHandle.removeServer(this, {4});return false;"></a>                                        </p>                                    </div>                                </li>');return c.render(e.serverName,e.link,e.timeStart,d,e.serverId)};a.editCategoryTemplate=function(d){var c=new zm.Template('<div class="formrow col1 fl">                    <span class="form_element_wrapper">                        <input oninput="zmFanPageAdminHandle.addValidateClass(this,1)" type="number" class="txtinput text_center" value="{2}">                    </span>                </div>                <div class="formrow  col2 fl">                    <span class="form_element_wrapper">                        <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)" value="{0}" type="text" value="" class="txtinput">\n                    </span>                </div>               <p class="formbtn col3 fr">                    <a href="#" onclick="zmFanPageAdminHandle.saveChangeCategory(this, {1}); return false;" class="zmbtn2">Cập nhật</a>                    <a href="#" onclick="zmFanPageAdminHandle.abortChangeCategory(this, {1}); return false;" class="zmbtndefault">Hủy bỏ</a>                </p>');return c.render(d.name,d.id,d.order)};a.newCategoryTemplate=function(d){var c=new zm.Template('<div class="addcate_row clearfix">                    <div class="formbtn fr"><a class="zmbtn2_block" href="#" onclick="zmFanPageAdminHandle.saveNewCategory(this); return false;">Thêm</a></div>                    <div class="formrow col1 fl">                        <span class="form_element_wrapper">                            <input type="number" step="1" max="100" class="txtinput" placeholder="Thứ tự" oninput="zmFanPageAdminHandle.addValidateClass(this,1)">                        </span>                    </div>                    <div class="formrow col2 fl">                        <span class="form_element_wrapper">                            <input type="text" class="txtinput" placeholder="Tên chuyên mục" oninput="zmFanPageAdminHandle.addValidateClass(this,2)">                        </span>                    </div>                </div>');return c.render()};a.displayCategoryItemTemplate=function(d){var c=new zm.Template('<li class="clearfix">                    <div class="article_rightfunc fr">                        <p class="article_control">                            <a title="Sửa" class="article_edit zmicn" href="#"                               onclick="zmFanPageAdminHandle.editCateCMS(this, {0}); return false;"></a>                            <a title="Xóa" class="article_del zmicn" href="#"                               onclick="zmFanPageAdminHandle.removeCateCMS(this, {0}); return false;"></a>                        </p>                    </div>                    <p class="article_index text_center fl"><strong>{1}</strong></p>                    <p class="article_text text_cutted"><strong class="article_texttitle">{2}</strong></p>                </li>');return c.render(d.id,d.order,d.name)};a.newMp3Template=function(){var c=new zm.Template('<div class="addserver_row clearfix">                    <div class="col1 fl">                        <div class = "formrow" >                            <span class = "form_element_wrapper" >                                <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)" id="mp3_name" type = "text" placeholder = "Tên bài hát" class = "txt_servname" >                            </span>                        </div>                    </div>                    <div class="col2 fl">                        <div class = "formrow" >                            <span class = "form_element_wrapper" >                                <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)" id="mp3_link" type="text" placeholder="http://" class="txt_servtime">                            </span>                        </div>                    </div>                    <div class="col4 fl">                        <div class="formrow"><a onclick="zmFanPageAdminHandle.putNewMp3(this); return false;" href="#" class="zmbtn2_block">Thêm</a></div>                    </div>                </div>');return c.render()};a.displayMp3Template=function(d){var c=new zm.Template('   <li class="clearfix">                                        <div class="col1 fl">                                            <div class="form_element text_cutted">						<strong>{0}</strong>                                            </div>					</div>					<div class="col2 text_cutted fl">                                            <div class="form_element text_cutted">						{1}                                            </div>					</div>					<div class="col4 fl">                                            <p class="article_control">						<a onclick="zmFanPageAdminHandle.editMp3(this,{2}); return false;" href="#" class="article_edit zmicn" title="Sửa"></a>						<a onclick="zmFanPageAdminHandle.removeMp3(this,{2}); return false;" href="#" class="article_del zmicn" title="Xóa"></a>                                            </p>					</div>                                    </li>');return c.render(d.title,d.targetLink,d.id)};a.renderEditMp3Form=function(d){var c=new zm.Template('<div class="col1 fl">                    <div class="formrow">			<span class="form_element_wrapper">                            <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)" type="text" placeholder="Tên bài hát" class="txtinput" value="{0}">			</span>                    </div>		</div>		<div class="col2 fl">                    <div class="formrow">			<span class="form_element_wrapper">                            <input oninput="zmFanPageAdminHandle.addValidateClass(this,2)" type="text" placeholder="http://" class="txtinput" value="{1}">                    	</span>                    </div>		</div>		<div class="col4 fl">                    <div class="formrow">			<input type="submit" class="zmbtn3" value="Xong" onclick="zmFanPageAdminHandle.saveEditMp3(this, {2});  return false;">                    </div>		</div>');return c.render(d.title,d.link,d.id)};a.renderPreviewCoverImage=function(d){var c=new zm.Template('<a href="#" class="article_picholder">                    <img id="item_imgLink" alt="" src="">                    <span onclick="zmFanPageAdminHandle.removeCoverToReupload(this); return false;"                        class="imgdel_icon" title="Xóa ảnh &amp; tải lại"><em class="zmicn"></em></span>                </a>');return c.render()};a.renderUploadCoverImage=function(){return'<a class="article_picholder" title="Tải ảnh lên" href="#">                    <span class="zmicn uplpic_icon"></span><strong>Chọn ảnh tải lên</strong>                    <input type="file" accept="image/*"onchange="zmFanPageAdminHandle.uploadImg(this);"></a>'};a.renderUploadCoverImageEdit=function(){return'<a class="article_picholder" title="Tải ảnh lên" href="#">                    <span class="zmicn uplpic_icon"></span><strong>Chọn ảnh tải lên</strong>                    <input type="file" accept="image/*"onchange="zmFanPageAdminHandle.uploadImg(this);"></a>'};a.saveNewCategory=function(h){var c=zm(h);var f=c.parent().parent();var e=zm("#new_cate").find("ul");var g={};g.order=f.find("div.formrow.col1 input").val();if(!g.order||g.order<0){f.find("div.formrow.col1 input").addClass("error")}g.name=f.find("div.formrow.col2 input").val();if(!g.name||g.name.trim().length<=0){f.find("div.formrow.col2 input").addClass("error")}if(g.order>=0&&g.name.trim().length>0){var d="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putcatecms";zm.post(d,g,{dataType:"json"},function(i){if(i.error>=0){g.id=i.cateId;e.append(a.displayCategoryItemTemplate(g));a.sortUlBaseOnOrder(e);f.remove();a.data.categoryFormNumber--;zmProfile.countCateCMS=zmProfile.countCateCMS+1;if(zmProfile.countCateCMS===3){zm("#add_new_cate").hide()}else{zm("#add_new_cate").show()}}})}};a.removeCoverToReupload=function(g){var c=zm(g);var d=zm(".article_picture.fl");zm(".article_picholder").remove();d.html(a.renderUploadCoverImage());try{zmProfile.boxy.itembox.hideMessage();zmProfile.boxy.itembox.hideLoading()}catch(f){}zm("#boxy_image_loading_mess").remove()};function b(c){return !isNaN(parseFloat(c))&&isFinite(c)}a.addValidateClass=function(c,e){var g=zm(c);var h=g.val();e=parseInt(e);if(e===1){if(b(h)&&h>=0){g.removeClass("error").addClass("zm-validated")}else{g.addClass("error").removeClass("zm-validated")}}else{if(e===2){if(h&&h.trim().length>0){g.removeClass("error").addClass("zm-validated")}else{g.addClass("error").removeClass("zm-validated")}}else{if(e===3){if(h&&h.indexOf("youtu")!==-1){g.removeClass("error").addClass("zm-validated")}else{g.addClass("error").removeClass("zm-validated")}}else{if(e===4){var i=new RegExp(a.timeRegex);if(h&&i.test(h)){g.removeClass("error")}else{g.addClass("error").removeClass("zm-validated")}}else{if(e===5){var d=h.indexOf("http://me.zing.vn/apps/");var f=false;if(h&&h.indexOf("_src")>0){f=true}if(h&&d>=0&&!f){g.removeClass("error").addClass("zm-validated")}else{g.addClass("error").removeClass("zm-validated")}}}}}}};a.uploadImg=function(k){var j=zm(k);var l=j.parent();var g=l.parent();var e=function(p){zmProfile.boxy.itembox.showLoading("Đang tải lên. Vui lòng chờ trong giây lát")};var d=function(p){};var n=function(p){f(p)};var i=function(p){};var f=function(p){zm(".imgdel_icon").click();try{zmProfile.boxy.itembox.hideLoading();zmProfile.boxy.itembox.showErrorMessage("Không thể tải được hình. Vui lòng thử lại")}catch(q){}if(zm("#edit_item").length>0){if(zm("#boxy_image_loading_mess").length>0){zm("#boxy_image_loading_mess").html("Không thể tải được hình. Vui lòng thử lại")}else{zm(".article_picholder").after('<div id="boxy_image_loading_mess" style="margin-left: 10px;">Không thể tải được hình. Vui lòng thử lại</div>')}}};function m(){if(zm("#edit_item").length>0){if(zm("#boxy_image_loading_mess").length>0){zm("#boxy_image_loading_mess").html('<p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>')}else{zm(".article_picholder").after('<div id="boxy_image_loading_mess" style="margin-left: 10px;"><p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p></div>')}}}var c=function(s){var p=false;var r=this;function q(){var t=r.responseText;var v=JSON.parse(t);if(v.error!==0){f();return}zm(".article_picholder").remove();zm(".article_picture").prepend(a.renderPreviewCoverImage(v.data));var u=document.getElementById("item_imgLink");zm(u).hide();u.onload=function(){zm(u).show();try{zmProfile.boxy.itembox.hideLoading();zmProfile.boxy.itembox.hideMessage()}catch(w){}p=true;zm("#boxy_image_loading_mess").remove()};u.onerror=function(){f()};setTimeout(function(){if(!p){u.onerror()}},10000);u.src=v.data.thumbnail_url}if(this.readyState===4&&this.status===200){setTimeout(q,1000)}};var o=a.createXMLHttpRequest();o.withCredentials=true;var h=new FormData();o.addEventListener("progress",e,false);o.addEventListener("load",d,false);o.addEventListener("error",n,false);o.addEventListener("abort",i,false);h.append("uploadField",k.files[0]);if(k.files[0].size<1048576){o.open("post","/fp/upload");o.onreadystatechange=c;o.send(h);m()}else{zmProfile.boxy.itembox.showErrorMessage("Kích thước hình quá lớn (>1MB)");if(zm("#edit_item").length>0){if(zm("#boxy_image_loading_mess").length>0){zm("#boxy_image_loading_mess").html("Kích thước hình quá lớn (>1MB)")}else{zm(".article_picholder").after('<div id="boxy_image_loading_mess" style="margin-left: 10px;">Kích thước hình quá lớn (>1MB)</div>')}}}};a.saveChangeCategory=function(g,h){var d=zm(g);var c=d.parent().parent();var f={};f.id=h;f.order=c.find("div.formrow.col1.fl input").val();f.name=c.find("div.formrow.col2.fl input.txtinput").val();if(f.order>=0&&f.name.trim().length>0){var e="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putcatecms";zm.post(e,f,{dataType:"json"},function(i){if(i.error>=0){c.html(a.data.category[h]);c.find("strong.article_texttitle").html(f.name);c.find(".article_index strong").html(f.order);a.sortUlBaseOnOrder(c.parent())}})}};a.sortUlBaseOnOrder=function(h){var d=h.html();var j=new Array();var f=h.find("li");var e=h.find("li").get(0);f.each(function(l,i){if(l===0){return}var m={};var k=zm(this);m.li=k;m.index=k.find(".article_index strong").html().trim();j.push(m)});h.html("");j.sort(function(k,i){return parseInt(k.index)-parseInt(i.index)});h.append(e);for(var g=0;g<j.length;g++){var c=j[g];h.append(c.li)}};a.newCateCMS=function(c,d){if(a.data.categoryFormNumber>0){return}zm("#new_cate").after(a.newCategoryTemplate());a.data.categoryFormNumber++;zm("#add_new_cate").hide()};a.editCateCMS=function(f,g){var d=zm(f);var c=d.parent().parent().parent();c.addClass("editting");a.data.category[g]=c.html();var e={};e.order=c.find(".article_index strong").html().trim();e.name=c.find("strong.article_texttitle").html().trim();e.id=g;c.html(a.editCategoryTemplate(e));return false};a.removeCateCMS=function(g,h){var e=confirm("Bạn thật sự muốn xóa chuyên mục này?");if(!e){return}var d=zm(g);var c=d.parent().parent().parent();var f="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=removecatecms&id="+h;zm.get(f,{dataType:"json"},function(i){if(i.error>=0){zmProfile.countCateCMS=zmProfile.countCateCMS-1;if(zmProfile.countCateCMS<3){zm("#add_new_cate").show()}c.remove()}})};a.abortChangeCategory=function(e,f){var d=zm(e);var c=d.parent().parent();c.removeClass("editting");c.html(a.data.category[f])};a.editServer=function(h,e){var d=zm(h);var f;var c=d.parent().parent().parent();f=c.html();a.data.server[e]={};a.data.server[e].html=f;var g={};g.serverName=c.find("div.col1 strong a").text().trim();g.openTime=c.find("div.col2 .form_element").text().trim();g.link=c.find("div.col1 strong a").attr("href");g.status=c.find("div.col3 .formrow").text().trim();g.serverId=e;c.html(a.renderEditServerForm(g));c.addClass("editing");switch(g.status){case"Đã mở":c.find(".selectbox").val(1);break;case"Chưa mở":c.find(".selectbox").val(2);break}return false};a.removeServer=function(h,g){var e=confirm("Bạn thật sự muốn xóa server này?");if(!e){return}var d=zm(h);var c=d.parent().parent().parent();var f="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=removeserver&id="+g;zm.get(f,{dataType:"json"},function(i){if(i.error>=0){c.remove()}})};a.revertChange=function(f,e){var d=zm(f);var c=d.parent().parent().parent();c.html(a.data.server[e].html)};a.newServer=function(e){if(a.data.serverFormNumber>0){return}var c=zm(e);var d=c.parent();d.before(a.newServerTemplate());a.data.serverFormNumber++;zm("#add_new_server").hide();return false};a.putNewServer=function(g){var c=zm(g);var h=c.parent().parent().parent();var e=h.parent().children("ul").get(0);var f={};f.serverName=h.find("div.col1 .txt_servname").val().trim();f.timeStart=h.find("div.col2 .txt_servtime").val();f.link=h.find("div.col1 .txt_servlink").val().trim();var i=new RegExp(a.timeRegex);f.status=h.find("div.col3 .selectbox").val();if(i.test(f.timeStart)&&f.serverName&&f.serverName&&h.find("div.col1 .txt_servlink").hasClass("zm-validated")){var d="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putserver";zm.post(d,f,{dataType:"json"},function(j){if(j.error>=0){f.serverId=j.serverId;e.append(a.displayServerTemplate(f));h.remove();a.data.serverFormNumber--;zm("#add_new_server").show()}})}};a.updateItem=function(h,i){var c=zm(h);var g=zm("#edit_item");var d='<div class="msg_error msg_symbol msginfo_nobg"><span class="msgicon"></span>Có lỗi xảy ra. Vui lòng thử lại</div>';var f={};f.id=i;f.name=g.find("#item_title").val().trim();f.targetLink=g.find("#item_targetLink").val().trim();f.desc=g.find("#item_desc").val().trim();f.cateCMS=g.find("#item_cate").val();f.highlights=g.find("#item_highlight").is(":checked")?"1":"0";if(!(f.name&&f.targetLink&&f.desc)){return}f.imgLink=g.find(".article_picholder img").attr("src");var e="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putitemcms";zm.post(e,f,{dataType:"json"},function(j){if(j.error>=0){zm("#edit_item").find("div.return_action").show()}else{h.parent().children("div").get(0).html(d).show()}})};a.highlights=function(f,g){var c=zm(f);var e;if(c.hasClass("actived")){e=0}else{e=1}var d="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=highlightsitemcms&id="+g+"&highlights="+e;zm.get(d,{dataType:"json"},function(h){if(h.error>=0){if(e===1){zm("#list_item ul li a.item_hot").removeClass("actived");c.addClass("actived")}else{c.removeClass("actived")}}})};a.removeItem=function(g,h){var e=confirm("Bạn thật sự muốn xóa tin tức này?");if(!e){return}var d=zm(g);var c=d.parent().parent().parent();var f="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=removeitemcms&id="+h;zm.get(f,{dataType:"json"},function(i){if(i.error>=0){c.remove()}})};a.closeEditBox=function(e,f){var c=zm(e);var d=c.parent().parent().parent();d.remove();zmProfile.boxy.itembox.center();return false};a.saveEditServer=function(h,f){var d=zm(h);var c=d.parent().parent().parent();var g={};g.id=f;g.serverName=c.find("div.col1 .txt_servname").val();g.timeStart=c.find("div.col2 .txt_servtime").val();g.link=c.find("div.col1 .txt_servlink").val().trim();g.status=c.find("div.col3 .selectbox").val();if(!g.serverName&&g.serverName.trim().length<=0){c.find("div.col1 .txt_servname").addClass("error")}var i=new RegExp(a.timeRegex);if(!i.test(g.timeStart)){c.find("div.col2 .txt_servtime").addClass("error")}if(g.link&&g.serverName.trim().length>0&&i.test(g.timeStart)&&c.find("div.col1 .txt_servlink").hasClass("zm-validated")){var e="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putserver";zm.post(e,g,{dataType:"json"},function(k){if(k.error>=0){c.html(a.data.server[f].html);var j=new zm.Template('<a href="{0}" target="_blank">{1}</a>');c.find("div.col1 strong").html(j.render(g.link,g.serverName));c.find("div.col2 .form_element").html(g.timeStart);c.removeClass("editing");var l;if(k.serverStatus===1){l='<div class="form_element text_cutted">Đã mở</div>'}else{l='<div class="form_element text_cutted">Sắp mở</div>'}c.find("div.col3 .formrow").html(l)}})}};a.removeMp3=function(g,h){var e=confirm("Bạn thật sự muốn xóa bài hát này?");if(!e){return}var d=zm(g);var c=d.parent().parent().parent();var f="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=removemp3&id="+h;zm.get(f,{dataType:"json"},function(i){if(i.error>=0){c.remove()}})};a.newMp3=function(e){if(a.data.mp3FormNumber>0){return}var c=zm(e);var d=c.parent();d.before(a.newMp3Template());a.data.mp3FormNumber++;zm("#add_new_mp3").hide();return false};a.putNewMp3=function(g){var c=zm(g);var h=c.parent().parent().parent();var e=h.parent().children("ul").get(0);var f={};f.title=zm("#mp3_name").val();f.targetLink=zm("#mp3_link").val();if(f.title.trim().length<=0){zm("#mp3_name").addClass("error")}if(f.targetLink.trim().length<=0){zm("#mp3_link").addClass("error")}if(f.title.trim().length>0&&f.targetLink.trim().length>0){var d="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putmp3";zm.post(d,f,{dataType:"json"},function(i){if(i.error>=0){f.id=i.id;e.append(a.displayMp3Template(f));h.remove();a.data.mp3FormNumber--;zm("#add_new_mp3").show()}})}};a.editMp3=function(g,h){var d=zm(g);var e;var c=d.parent().parent().parent();e=c.html();a.data.mp3[h]={};a.data.mp3[h].html=e;var f={};f.title=c.find("div.col1 strong").html().trim();f.link=c.find("div.col2 .form_element").html().trim();f.id=h;c.html(a.renderEditMp3Form(f));c.addClass("editing");return false};a.saveEditMp3=function(g,h){var d=zm(g);var c=d.parent().parent().parent();var f={};f.id=h;f.title=c.find("div.col1 .txtinput").val();f.targetLink=c.find("div.col2 .txtinput").val();if(f.title.trim().length<=0){c.find("div.col1 .txtinput").addClass("error")}if(f.targetLink.trim().length<=0){c.find("div.col2 .txtinput").addClass("error")}if(f.title.trim().length>0&&f.targetLink.trim().length>0){var e="/v/"+zmConfig.ownerName+"/boxfanpage?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&action=putmp3";zm.post(e,f,{dataType:"json"},function(i){if(i.error>=0){c.html(a.data.mp3[h].html);c.find("div.col1 strong").html(f.title);c.find("div.col2 .form_element").html(f.targetLink);c.removeClass("editing")}})}};return a})();var zmTheme=(function(){var e,u=false,f=1;var v,l,h,a;var j=1000;function y(){return'<div class="prftheme_library">                    <div class="zmthemelib_topnav">                        <div class="zm_innerwrapper clearfix">                                <a href="#" class="prfthemelib_close trans text_center fr" title="Đóng"><span>×</span></a>                                <div class="zmtheme_default fr" style="display: none;">                                        <input name="checkboxlist" id="ResetToDefaultTheme" type="checkbox">                                        <label for="ResetToDefaultTheme" class="trans">                                                <span class="checkbox"></span>Chọn giao diện mặc định                                        </label>                                </div>                                <ul class="fl zmthemelib_nav text_large">                                        <li><a class="selected" href="#" type="library"><span class="zmicn16 themelib_icn"></span><strong>Thư viện hình nền</strong></a></li>                                        <li><a href="#" type="custom"><span class="zmicn16 customtheme_icn"></span><strong>Tùy chỉnh giao diện</strong></a></li>                                </ul>                        </div>                    </div>                    '+zmTheme.Library.renderTab()+"                    "+zmTheme.Custom.renderTab()+"                </div>"}function c(I,H){e=true;zm.post("/theme/reset",{viewerId:zmConfig.viewerId,time:zmConfig.time,token:zmConfig.token},{dataType:"json"},function(J){if(J.error>=0){zm.isFunction(I)&&I(J)}else{zm.isFunction(H)&&H(J)}e=false},function(){e=false})}function F(H){if(H){zm(".zm_pfcover .pfctncover .avt_edit_icon.zmbtn3").show()}else{zm(".zm_pfcover .pfctncover .avt_edit_icon.zmbtn3").hide()}}function s(){zm(".prftheme_library .pftheme_bottom .msg_symbol").hide()}function m(H,I){s();if(H=="success"){zm(".prftheme_library .pftheme_bottom .msg_success .message").text(I);zm(".prftheme_library .pftheme_bottom .msg_success").show()}else{if(H=="error"){zm(".prftheme_library .pftheme_bottom .msg_error .message").text(I);zm(".prftheme_library .pftheme_bottom .msg_error").show()}else{if(H=="warning"){zm(".prftheme_library .pftheme_bottom .msg_warning .message").text(I);zm(".prftheme_library .pftheme_bottom .msg_warning").show()}}}}function b(I,H){if(I=="add"){if(zm("#ThemeStyle").length){zm("#ThemeStyle").attr("href",H)}else{var J=document.createElement("link");J.id="ThemeStyle";J.rel="stylesheet";J.type="text/css";J.href=H;document.getElementsByTagName("head")[0].appendChild(J)}}else{if(I=="remove"){zm("#ThemeStyle").remove()}}}function i(){zm(".pfcover_img .cover_img").attr("src",v);if(l!=""&&l!="none"){zm(".zmviewport .zmbgtheme").css("background-image","url("+l+")")}else{zm(".zmviewport .zmbgtheme").css("background-image","")}if(h!=""&&h!="none"){zm(".zmviewport .zmbgtheme").css("background-color",h)}else{zm(".zmviewport .zmbgtheme").css("background-color","")}if(a!=""&&a!="none"){b("add",a)}else{b("remove")}}function C(){if(zm(".zmviewport").outerWidth()%2>0){zm(".zmbgtheme").addClass("fixgap")}else{zm(".zmbgtheme").removeClass("fixgap")}}function B(H){if(H&&H.indexOf("url")==0){return H.replace('"',"").slice(4,-1)}return H}function t(){return v}function g(H){v=H}function r(){return l}function A(H){l=H}function E(){return h}function x(H){h=H}function k(){return a}function q(H){a=H}function G(I){var H=I.toString(16);return H.length==1?"0"+H:H}function z(J,I,H){return"#"+G(J)+G(I)+G(H)}function d(J){if(J.indexOf("rgb")==0){var I=J.substring(4,J.length-1).split(","),L=zm.intval(I[0].trim()),K=zm.intval(I[1].trim()),H=zm.intval(I[2].trim());return z(L,K,H)}}function o(){zm(".zmviewport").on("click",".editpfcover",function(H){H.preventDefault();u=zm(".zm_innerwrapper").hasClass("moveto_left");zmTheme.Library.getData(function(){if(zm(".zmviewport .prftheme_library").length){zm(".zmviewport .prftheme_library").remove()}var J=y();zm(".zmviewport").prepend(J);if(zm(".zm_pfcover .pfctncover .cover_drag_overlap").length){zm(".zm_pfcover .pfctncover .cover_drag_overlap").remove()}var I=zmTheme.Custom.renderLargeCoverOverlap();zm(".zm_pfcover .pfctncover").prepend(I);if(zm("#UploadCoverCanvas").length){zm("#UploadCoverCanvas").remove()}zm(".zm_pfcover .pfcover_img").prepend('<canvas id="UploadCoverCanvas" width="980" height="300" style="display: none;">												Your browser does not support the HTML5 canvas												</canvas>');if(zm("#UploadBackgroundCanvas").length){zm("#UploadBackgroundCanvas").remove()}zm(".zmbgtheme").after('<canvas id="UploadBackgroundCanvas" width="1000" height="300" style="display: none;">												Your browser does not support the HTML5 canvas												</canvas>');zm("#zm_ticker").hide();if(u){zm(".zm_innerwrapper").removeClass("moveto_left")}zm("body").addClass("zmtheme_update");F(false)})})}function n(){zm(".zmviewport").on("click",".prftheme_library .prfthemelib_close",function(H){H.preventDefault();zm(".prftheme_library").hide();zm("body").removeClass("zmtheme_update");F(true);zmTheme.Library.resetOtherValues();zmTheme.Library.resetSelectedValues();zmTheme.Custom.resetOtherValues();zmTheme.Custom.setCoverOverlapDisplayStatus(false);zm("#UploadCoverCanvas").remove();zm("#UploadBackgroundCanvas").remove();i();s();zm("#zm_ticker").show();if(u){zm(".zm_innerwrapper").addClass("moveto_left")}f=1})}function w(){zm(".zmviewport").on("click",".prftheme_library .pftheme_updtbtn .submitbtn",function(H){H.preventDefault();if(f==1){zmTheme.Library.saveTheme()}else{if(f==2){zmTheme.Custom.saveCustom()}}})}function D(){zm(".zmviewport").on("click",".prftheme_library .zmthemelib_nav li a",function(K){K.preventDefault();var H=zm(this),I=H.attr("type"),J=H.parents(".zmthemelib_nav");s();J.find("li a").removeClass("selected");H.addClass("selected");if(I=="library"){if(f==1){return}f=1;zm(".prftheme_library .zmthemelib_navcontent").hide();zm('.prftheme_library .zmthemelib_navcontent[type="library"]').show();if(zmTheme.Custom.getCoverInteractStatus()){zmTheme.Custom.setCoverOverlapDisplayStatus(false)}zmTheme.Library.previewTheme(true)}else{if(I=="custom"){if(f==2){return}f=2;zm(".prftheme_library .zmthemelib_navcontent").hide();zm('.prftheme_library .zmthemelib_navcontent[type="custom"]').show();zmTheme.Custom.getData(function(){if(zmTheme.Custom.getCoverInteractStatus()){zmTheme.Custom.setCoverOverlapDisplayStatus(true)}zmTheme.Custom.previewCustom(true)})}}})}function p(){zm(window).resize(function(){C()})}return{init:function(){if(zm.intval(zmConfig.viewerId)<=0||zmConfig.pageName!="profile"){return}zm(".zmviewport .zmbgtheme").addClass("theme_actived");C();v=zm(".pfcover_img .cover_img").attr("src");l=B(zm(".zmviewport .zmbgtheme").css("background-image"));h=d(zm(".zmviewport .zmbgtheme").css("background-color"));a=zm("#ThemeStyle").attr("href")?zm("#ThemeStyle").attr("href"):"none";o();n();w();D();p();zmTheme.Library.init();zmTheme.Custom.init()},getCurrentCover:t,setCurrentCover:g,getCurrentBackground:r,setCurrentBackground:A,getCurrentBackgroundColor:E,setCurrentBackgroundColor:x,getCurrentCss:k,setCurrentCss:q,hideAllMessage:s,showMessage:m,changeCss:b,rgbToHex:z,parseBgColorValueToHex:d,TIMEOUT_TO_HIDE:j}})();zm.ready(zmTheme.init);zmTheme.Library=(function(){var g,a=true;var j=[],B={};var h=-1,x=-1,k=-1,w="",f="",i="",b="";var F=8;function e(){var H=[],K=0,M=B[h],L=M.length,I=Math.ceil(L/F);for(var J=0;J<L;J++){if(K==F){break}H.push(M[J]);K++}return'<div class="zmthemelib_navcontent" type="library">                    <div class="zm_innerwrapper clearfix">                        <div class="prftheme_content">                            <ul class="pfthsubnav clearfix">'+d(j)+'</ul>                            <div class="pfcover_list_wrapper">'+m(H)+'</div>                        </div>                    </div>                    <div class="pftheme_bottom clearfix">'+l(I)+"</div>                </div>"}function d(K){if(!K||!K.length){return""}var J=K.length,I="";for(var H=0;H<J;H++){if(H==0){I+='<li cateId="'+K[H].id+'"><a class="selected" href="#">'+K[H].name+"</a></li>"}else{I+='<li cateId="'+K[H].id+'"><a href="#">'+K[H].name+"</a></li>"}}return I}function m(K){if(!K||!K.length){return""}var J=K.length,I='<ul class="pfcover_list">';for(var H=0;H<J;H++){I+='<li themeId="'+K[H].id+'" class="pfc_list_item">                        <a class="pfc_item_wrapper block trans" href="#"><span class="zmicn"></span><img class="trans" src="'+zmConfig.THEME_URL+"/"+K[H].id+"/"+K[H].cover+'" alt=""></a>                    </li>'}I+="</ul>";return I}function l(H){return'<div class="zm_innerwrapper">                    <ul class="pfcover_list_paginator fl">'+s(H)+'</ul>                    <div class="pftheme_updtbtn text_right fr">                        <a class="submitbtn zmbtn2" href="#">Cập nhật giao diện</a>                    </div>                    <div class="prfthem_feedback_msg">                        <div class="msg_success text_small msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                        <div class="msg_warning text_small msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                        <div class="msg_error msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                    </div>                </div>'}function s(J){if(J<2){return""}var I="";for(var H=0;H<J;H++){if(H==0){I+='<li class="selected"><span>'+(H+1)+"</span></li>"}else{I+='<li><a href="#">'+(H+1)+"</a></li>"}}return I}function o(I,J,H){g=true;zm.post("/theme/savedefault",{themeId:I,viewerId:zmConfig.viewerId,time:zmConfig.time,token:zmConfig.token},{dataType:"json"},function(K){if(K.error>=0){zm.isFunction(J)&&J(K)}else{zm.isFunction(H)&&H(K)}g=false},function(){g=false})}function A(J,I,H){g=true;zm.post("/theme/getdefault",{cateId:(J>=0?J:-1),viewerId:zmConfig.viewerId,time:zmConfig.time,token:zmConfig.token},{dataType:"json"},function(K){if(K.error>=0){zm.isFunction(I)&&I(K)}else{zm.isFunction(H)&&H(K)}g=false},function(){g=false})}function c(){if(k>=0){zm(".prftheme_library .submitbtn").addClass("disable");o(k,function(){a=true;r();zmTheme.showMessage("success","Cập nhật giao diện thành công.");setTimeout(function(){zm(".prftheme_library .prfthemelib_close").click();zm(".prftheme_library .submitbtn").removeClass("disable")},zmTheme.TIMEOUT_TO_HIDE)},function(){a=false;zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.");zm(".prftheme_library .submitbtn").removeClass("disable")})}else{zmTheme.showMessage("warning","Vui lòng chọn giao diện trước khi cập nhật.")}}function n(H){if(!zm.objectLength(B)||!j.length){A(null,function(I){if(I.data&&I.data.cates&&I.data.firstCate){j=I.data.cates;h=j[0].id;x=1;B[h]=[];B[h]=I.data.firstCate;w=zmTheme.getCurrentCover();f=zmTheme.getCurrentBackground();i=zmTheme.getCurrentBackgroundColor();b=zmTheme.getCurrentCss();if(zm.isFunction(H)){H()}}},function(){zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.")})}else{h=j[0].id;x=1;w=zmTheme.getCurrentCover();f=zmTheme.getCurrentBackground();i=zmTheme.getCurrentBackgroundColor();b=zmTheme.getCurrentCss();if(zm.isFunction(H)){H()}}}function v(L,H){var J=B[L];for(var I=0,K=J.length;I<K;I++){if(J[I].id==H){return J[I]}}}function z(J,I){if(J<0){zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.")}var H;if(B[J]){u(J,I);H=Math.ceil(B[J].length/F);zm(".pfcover_list_paginator").html(s(H))}else{A(J,function(O){if(O.data){B[J]=O.data;var K=[],M=0,N=O.data.length;for(var L=0;L<N;L++){if(M==F){break}K.push(B[J][L]);M++}zm(".pfcover_list_wrapper").html(m(K));H=Math.ceil(N/F);zm(".pfcover_list_paginator").html(s(H))}},function(K){if(K.error==-10){zmTheme.showMessage("warning","Hiện chưa có giao diện nào trong chủ đề này. Vui lòng chọn chủ đề khác.")}else{zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.")}})}}function u(M,L){if(!L){zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.")}var J=F*(L-1),N=B[M].length;if(J>N-1){zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.")}var H=[],K=0;for(var I=J;I<N;I++){if(K==F){break}H.push(B[M][I]);K++}zm(".pfcover_list_wrapper").html(m(H))}function y(H){if(w!=""&&w!="none"){if(w.indexOf(zmConfig.THEME_URL)<0&&k>=0){w=zmConfig.THEME_URL+"/"+k+"/"+w}zm(".pfcover_img .cover_img").attr("src",w)}else{w="";if(H){zm(".pfcover_img .cover_img").attr("src",w)}}if(f!=""&&f!="none"){if(f.indexOf(zmConfig.THEME_URL)<0&&k>=0){f=zmConfig.THEME_URL+"/"+k+"/"+f}zm(".zmviewport .zmbgtheme").css("background-image","url("+f+")")}else{f="";if(H){zm(".zmviewport .zmbgtheme").css("background-image",f)}}if(i!=""&&i!="none"){zm(".zmviewport .zmbgtheme").css("background-color",i)}else{i="";if(H){zm(".zmviewport .zmbgtheme").css("background-color",i)}}if(b!=""&&b!="none"){if(b.indexOf(zmConfig.THEME_URL)<0&&k>=0){b=zmConfig.THEME_URL+"/"+k+"/"+b}zmTheme.changeCss("add",b)}else{b="";if(H){zmTheme.changeCss("remove")}}}function r(){zmTheme.setCurrentCover(w);zmTheme.setCurrentBackground(f);zmTheme.setCurrentBackgroundColor(i);zmTheme.setCurrentCss(b)}function E(){w="";f="";i="";b=""}function D(){h=-1;x=-1;k=-1}function p(){return a}function q(H){a=H}function G(){zm(".zmviewport").on("click",".prftheme_library .prftheme_content .pfthsubnav li a",function(J){J.preventDefault();var H=zm(this),I=H.parents(".pfthsubnav");I.find("li a").removeClass("selected");H.addClass("selected");h=zm.intval(H.parent().attr("cateId"));x=1;z(h,x);if(k>=0){zm('.prftheme_library .pfcover_list li[themeId="'+k+'"]').addClass("selected")}zmTheme.hideAllMessage()})}function t(){zm(".zmviewport").on("click",".prftheme_library .pftheme_bottom .pfcover_list_paginator li a",function(K){K.preventDefault();var H=zm(this),J=H.parents(".pfcover_list_paginator"),I;I=J.find("li.selected");if(I.length){I.removeClass("selected");I.html('<a href="#">'+I.text()+"</a>")}x=zm.intval(H.text());H.parent().addClass("selected");H.parent().html("<span>"+x+"</span>");u(h,x);if(k>=0){zm('.prftheme_library .pfcover_list li[themeId="'+k+'"]').addClass("selected")}zmTheme.hideAllMessage()})}function C(){zm(".zmviewport").on("click",".prftheme_library .prftheme_content .pfcover_list li a",function(K){K.preventDefault();var H=zm(this),J=H.parents(".pfcover_list");J.find("li").removeClass("selected");H.parent().addClass("selected");k=zm.intval(H.parent().attr("themeId"));var I=v(h,k);w=I.cover;f=I.bgTheme;i=I.bgColor;b=I.css;y();zmTheme.hideAllMessage()})}return{init:function(){if(zm.intval(zmConfig.viewerId)<=0||zmConfig.pageName!="profile"){return}G();t();C()},previewTheme:y,saveTheme:c,getData:n,renderTab:e,resetSelectedValues:E,resetOtherValues:D,getUseThemeStatus:p,setUseThemeStatus:q}})();zmTheme.Custom=(function(){var ak,ad=false,ar=false;var y=false,B=0,aw=0,b=100,aE=327,aq=false,ac=0,s=0,L=300,G=980,m=300,O=1000,aA=720,ah=1920,E=Math.floor(L/b);var aH=null,aD=null,a=null,v=null,C=-1,S=-1,an=null,X=null,az=null,F=null,z=-1;var T="",J="",H="",t=false,x=false,j=false;var M="#e1ebf5",l=5242880,D=/image\/(png|jpeg)/,ae=5242880,au=/image\/(png|jpeg)/;function aF(){var aL,aM,aN;if(T){aL=W(T)}else{aL=p()}if(J){aM=k(J)}else{aM=am()}if(H){aN=r(null,H)}else{aN=e()}return'<div class="zmthemelib_navcontent" type="custom">                    <div class="zm_innerwrapper clearfix">                        <div class="prftheme_content">                            <div class="clearfix theme_custom">                                <div class="thcustom_col fl cover_column">                                    <div class="thcustom_col_inner">'+aL+'</div>                                </div>                                <div class="thcustom_col fl background_column">                                    <div class="thcustom_col_inner">'+aM+'</div>                                </div>                                <div class="thcustom_col lastcol fl bgcolor_column">                                    <div class="thcustom_col_inner">'+aN+'</div>                                </div>                            </div>                        </div>                    </div>                    <div class="pftheme_bottom clearfix">                        <div class="zm_innerwrapper">                            <div class="dload_theme_guideline fl" style="display: none;">                                Tự làm giao diện cho riêng mình?<br>                                <a href="#" class="text_success"><span class="zmicn16 dload_icn"></span><strong>Tải ngay file mẫu hướng dẫn thiết kế</strong></a>                            </div>                            <div class="fr pftheme_updtbtn text_right fr">                                <a class="delthemebtn zmbtndefault" href="#"><span class="zmicn16 bin_icon"></span>Xóa giao diện này</a>                                <a class="submitbtn zmbtn2" href="#">Cập nhật giao diện</a>                            </div>                            <div class="prfthem_feedback_msg">                                    <div class="msg_success text_small msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                                    <div class="msg_warning text_small msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                                    <div class="msg_error msg_symbol" style="display: none;"><span class="msgicon"></span><span class="message"></span></div>                            </div>                        </div>                    </div>                </div>'}function ai(){return'<div class="zmthemelib_navcontent" type="custom" style="display: none;">					<div class="zm_innerwrapper clearfix">						<div class="zmloading64" style="height: 220px;">							<em style="margin-top: 70px;"></em>						</div>					</div>					<div class="pftheme_bottom clearfix">						<div class="zm_innerwrapper">							<div class="dload_theme_guideline fl" style="display: none;">								Tự làm giao diện cho riêng mình?<br>								<a href="#" class="text_success"><span class="zmicn16 dload_icn"></span><strong>Tải ngay file mẫu hướng dẫn thiết kế</strong></a>							</div>							<div class="fr pftheme_updtbtn text_right fr">								<a class="delthemebtn zmbtndefault disable" href="#"><span class="zmicn16 bin_icon"></span>Xóa giao diện này</a>								<a class="submitbtn zmbtn2 disable" href="#">Cập nhật giao diện</a>							</div>						</div>					</div>				</div>'}function d(){return'<ul class="select_colorcode clearfix">					<li><a title="#f9b91e" color="#f9b91e" href="#" class="colorswch_cell" style="background-color:#f9b91e"><em class="zmicn16"></em></a></li>					<li><a title="#e74c3c" color="#e74c3c" href="#" class="colorswch_cell" style="background-color:#e74c3c"><em class="zmicn16"></em></a></li>					<li><a title="#e96688" color="#e96688" href="#" class="colorswch_cell" style="background-color:#e96688"><em class="zmicn16"></em></a></li>					<li><a title="#d61d5f" color="#d61d5f" href="#" class="colorswch_cell" style="background-color:#d61d5f"><em class="zmicn16"></em></a></li>					<li><a title="#633f21" color="#633f21" href="#" class="colorswch_cell" style="background-color:#633f21"><em class="zmicn16"></em></a></li>					<li><a title="#39220f" color="#39220f" href="#" class="colorswch_cell" style="background-color:#39220f"><em class="zmicn16"></em></a></li>					<li><a title="#8e44ad" color="#8e44ad" href="#" class="colorswch_cell" style="background-color:#8e44ad"><em class="zmicn16"></em></a></li>					<li><a title="#571b85" color="#571b85" href="#" class="colorswch_cell" style="background-color:#571b85"><em class="zmicn16"></em></a></li>					<li><a title="#2ecc71" color="#2ecc71" href="#" class="colorswch_cell" style="background-color:#2ecc71"><em class="zmicn16"></em></a></li>					<li><a title="#1abc9c" color="#1abc9c" href="#" class="colorswch_cell" style="background-color:#1abc9c"><em class="zmicn16"></em></a></li>					<li><a title="#02896e" color="#02896e" href="#" class="colorswch_cell" style="background-color:#02896e"><em class="zmicn16"></em></a></li>					<li><a title="#9cd7ff" color="#9cd7ff" href="#" class="colorswch_cell" style="background-color:#9cd7ff"><em class="zmicn16"></em></a></li>					<li><a title="#3498db" color="#3498db" href="#" class="colorswch_cell" style="background-color:#3498db"><em class="zmicn16"></em></a></li>					<li><a title="#1972ad" color="#1972ad" href="#" class="colorswch_cell" style="background-color:#1972ad"><em class="zmicn16"></em></a></li>					<li><a title="#586e84" color="#586e84" href="#" class="colorswch_cell" style="background-color:#586e84"><em class="zmicn16"></em></a></li>					<li><a title="#2c3e50" color="#2c3e50" href="#" class="colorswch_cell" style="background-color:#2c3e50"><em class="zmicn16"></em></a></li>				</ul>'}function g(){return'<div class="cover_drag_overlap trans text_center" style="display: none;">                    <div class="gapmoving_tool">                        <a href="#" class="moving_up trans" title="Lên"><span class="zmicn16"></span></a>                        <a href="#" class="moving_down trans" title="Xuống"><span class="zmicn16"></span></a>                    </div>                    <div class="cover_drag_taglabel text_small trans">                        <p><span class="zmicn16 covermove_icon"></span>Giữ và di chuyển chuột để xác định vị trí</p>                        <p>                            <input name="HideAvatarToPreviewInput" id="HideAvatarToPreviewInput" type="checkbox">                            <label id="HideAvatarToPreviewButton" for="HideAvatarToPreviewInput">                                <span class="checkbox"></span>                                Ẩn / hiện ảnh đại diện để xem trước                            </label>                        </p>                    </div>                </div>'}function p(){return'<h3 class="thcustom_heading"><span>1</span>Ảnh bìa</h3>				<div id="UploadCoverButton" class="btn_uploadcover trans">					<span class="btn_uploadcover_icn trans">+</span>				</div>				<input id="UploadCoverInput" accept="image/*" type="file" style="display: none;"></input>				<div class="text_muted uploadcover_tip">					Cho phép định dạng ảnh <strong>PNG, JPG</strong>.<br>					Dung lượng <strong>tối đa 5 MB</strong>.<br>					Kích thước <strong>tối thiểu 980 x 300</strong>.				</div>'}function W(aL){return'<h3 class="thcustom_heading">					<a href="#" onclick="zm(\'#UploadCoverInput\').click(); return false;" class="fr reupl_file text_primary"><em class="zmicn16"></em>Đổi ảnh</a>					<span>1</span>Ảnh bìa                </h3>                <input id="UploadCoverInput" accept="image/*" type="file" style="display: none;">                <div class="cover_scaled">					<p class="move_cover_overlap"><span class="zmicn covermove_icon"></span></p>					<img src="'+aL+'" alt="">                </div>                <p class="text_primary">Nhấn giữ chuột trên ảnh và di chuyển ảnh trong để xác định vùng hiển thị làm ảnh bìa</p>'}function am(){return'<h3 class="thcustom_heading"><span>2</span>Ảnh nền</h3>				<div id="UploadBackgroundButton" class="btn_uploadcover trans">					<span class="btn_uploadcover_icn trans">+</span>				</div>				<input id="UploadBackgroundInput" accept="image/*" type="file" style="display: none;"></input>				<div class="text_muted uploadcover_tip">					Cho phép định dạng ảnh <strong>PNG, JPG</strong>.<br>					Dung lượng <strong>tối đa 5 MB</strong>.<br>					Kích thước <strong>tối thiểu 1000 x 300</strong>.				</div>'}function k(aL){return'<h3 class="thcustom_heading">					<a href="#" onclick="zm(\'#UploadBackgroundInput\').click(); return false;" class="fr reupl_file text_primary"><em class="zmicn16"></em>Đổi ảnh</a>					<span>2</span>Ảnh nền				</h3>				<input id="UploadBackgroundInput" accept="image/*" type="file" style="display: none;">				<div class="bgtheme_scaled">					<img src="'+aL+'" alt="">				</div>				<p class="text_primary">					<input name="DontUseBackgroundInput" id="DontUseBackgroundInput" type="checkbox">					<label id="DontUseBackgroundButton" for="DontUseBackgroundInput" class="trans">						<span class="checkbox"></span>						Không hiện ảnh nền, chỉ dùng màu nền					</label>				</p>'}function e(){return'<h3 class="thcustom_heading"><span>3</span>Màu nền</h3>				<div class="colorswatch_board">                    <div class="suggest_color text_primary disabled">                        <span class="dirarrow zmicn"></span>                        <span class="colorswch_cell fl"><em class="zmicn16"></em></span>                        Màu gợi ý theo hình nền của bạn                    </div>                    <div class="colorswtch_available">                        '+d()+'                        <div class="enter_colorcode">                            <label class="fl text_primary">Chọn màu bạn thích</label>                            <div class="colorcode_textbox">                                <a href="#" title="Hủy" class="del_colorcode fr"><em class="zmicn16"></em></a>                                <span id="ColorCodeCustomDisplay" class="colorswch_cell fl" style="background-color:#0084ff"><em class="zmicn16"></em></span>                                <span class="colorcode_input">									<input id="ColorCodeCustomInput" maxlength="7" placeholder="#" type="text">									<input id="ColorCodePicker" type="color" style="opacity: 0;">								</span>                            </div>                        </div>                    </div>                </div>'}function r(aM,aL){return'<h3 class="thcustom_heading"><span>3</span>Màu nền</h3>				<div class="colorswatch_board">					<div class="suggest_color text_primary" style="cursor: pointer;">						<span class="dirarrow zmicn"></span>						<span id="ColorCodeSuggestDisplay" class="colorswch_cell selected fl" color="'+(aM?aM:M)+'" style="background-color:'+(aM?aM:M)+'"><em class="zmicn16"></em></span>						Màu gợi ý theo hình nền của bạn					</div>					<div class="colorswtch_available">						'+d()+'						<div class="enter_colorcode">							<label class="fl text_primary">Chọn màu bạn thích</label>							<div class="colorcode_textbox">								<a href="#" title="Hủy" class="del_colorcode fr"><em class="zmicn16"></em></a>								<span id="ColorCodeCustomDisplay" class="colorswch_cell fl" style="background-color:'+aL+'"><em class="zmicn16"></em></span>								<span class="colorcode_input">									<input id="ColorCodeCustomInput" maxlength="7" placeholder="#" type="text">									<input id="ColorCodePicker" type="color" style="opacity: 0;">								</span>							</div>						</div>					</div>				</div>'}function f(aO,aM,aN,aP,aL){ak=true;zm.post("/theme/savecustom",{cover:(aO?aO:""),bg:(aM?aM:""),bgColor:(aN?aN:""),viewerId:zmConfig.viewerId,time:zmConfig.time,token:zmConfig.token},{dataType:"json"},function(aQ){if(aQ.error>=0){zm.isFunction(aP)&&aP(aQ)}else{zm.isFunction(aL)&&aL(aQ)}ak=false},function(){ak=false})}function i(aM,aL){ak=true;zm.post("/theme/getcustom",{viewerId:zmConfig.viewerId,time:zmConfig.time,token:zmConfig.token},{dataType:"json"},function(aN){if(aN.error>=0){zm.isFunction(aM)&&aM(aN)}else{zm.isFunction(aL)&&aL(aN)}ak=false},function(){ak=false})}function V(){if(aa()){var aN,aL,aM;if(t&&a!=null){av();aN=aH.toDataURL("image/jpeg");T=aN;aN=aN.substring(23)}else{aN=""}if(x&&az!=null&&ar){ay();aL=an.toDataURL("image/jpeg");J=aL;aL=aL.substring(23)}else{if(az!=null&&ar){aL="useOld"}else{aL="";J=""}}if(j||H){aM=H}else{aM="";H=""}zm(".prftheme_library .submitbtn").addClass("disable");f(aN,aL,aM,function(){I();Q();zmTheme.showMessage("success","Cập nhật giao diện thành công.");setTimeout(function(){zm(".prftheme_library .prfthemelib_close").click();zm(".prftheme_library .submitbtn").removeClass("disable")},zmTheme.TIMEOUT_TO_HIDE)},function(){zmTheme.showMessage("warning","Có lỗi không mong muốn xảy ra. Bạn vui lòng thực hiện lại.");zm(".prftheme_library .submitbtn").removeClass("disable")})}else{if(T){zmTheme.showMessage("warning","Vui lòng tùy chỉnh giao diện trước khi cập nhật.")}else{zmTheme.showMessage("warning","Vui lòng chọn ảnh bìa và tùy chỉnh giao diện trước khi cập nhật.")}}}function aJ(aL){if(!ad){i(function(aP){if(aP.data){var aO=aP.data.cover;if(aO){T=aO;al()}var aN=aP.data.bg;if(aN){J=aN;ar=true;o()}var aM=aP.data.bgColor;if(aM){H=aM}zm('.prftheme_library .zmthemelib_navcontent[type="custom"]').remove();zm(".prftheme_library").append(aF());if(H){zm("#ColorCodeCustomInput").val(H)}ad=true;if(zm.isFunction(aL)){aL()}}},function(){zm('.prftheme_library .zmthemelib_navcontent[type="custom"]').remove();zm(".prftheme_library").append(aF());ad=true;if(zm.isFunction(aL)){aL()}})}else{zm('.prftheme_library .zmthemelib_navcontent[type="custom"]').remove();zm(".prftheme_library").append(aF());if(H){zm("#ColorCodeCustomInput").val(H)}if(zm.isFunction(aL)){aL()}}}function aC(aL){aH=document.getElementById("UploadCoverCanvas");aD=aH.getContext("2d");a=aL;C=G/aL.width;S=aE/aL.width;B=0;ac=0;aw=0;s=0;U()}function av(){aD.setTransform(1,0,0,1,0,0);aD.clearRect(0,0,G,L);aD.drawImage(a,0,Math.abs(s)/C,a.width,L/C,0,0,G,L)}function Y(aL){an=document.getElementById("UploadBackgroundCanvas");if(aL.width>ah){z=ah/aL.width;an.setAttribute("width",ah);if(aL.height*z>aA){an.setAttribute("height",aA)}else{an.setAttribute("height",aL.height*z)}}else{z=1;an.setAttribute("width",aL.width);if(aL.height>aA){an.setAttribute("height",aA)}else{an.setAttribute("height",aL.height)}}X=an.getContext("2d");az=aL}function ay(){X.setTransform(1,0,0,1,0,0);X.clearRect(0,0,an.getAttribute("width"),an.getAttribute("height"));if(az.width>ah){if(az.height*z>aA){X.drawImage(az,0,0,az.width,aA/z,0,0,ah,aA)}else{X.drawImage(az,0,0,az.width,az.height,0,0,ah,az.height*z)}}else{if(az.height>aA){X.drawImage(az,0,0,az.width,aA,0,0,az.width,aA)}else{X.drawImage(az,0,0,az.width,az.height,0,0,az.width,az.height)}}}function ao(aM){var aL=zmTheme.Util.ColorThief.getColor(aM);return aL}function af(aL){if(aL){zm(".zm_pfcover .pfctncover .pfavatar").show()}else{zm(".zm_pfcover .pfctncover .pfavatar").hide()}}function n(aL){if(aL){zm(".zm_pfcover .pfctncover").addClass("cover_drag");zm(".zm_pfcover .pfctncover .cover_drag_overlap").show()}else{zm(".zm_pfcover .pfctncover").removeClass("cover_drag");zm(".zm_pfcover .pfctncover .cover_drag_overlap").hide()}}function c(){aw=Math.floor(s/E)}function ap(){s=Math.floor(aw*E)}function U(){zm(".prftheme_library .prftheme_content .cover_scaled img").css("top",aw+"px");zm(".pfcover_img .cover_img").css("top",s+"px")}function w(aL){if(T!=""&&T!="none"){zm(".pfcover_img .cover_img").attr("src",T)}else{T="";if(aL){zm(".pfcover_img .cover_img").attr("src",T)}}if(ar){if(J!=""&&J!="none"){zm(".zmviewport .zmbgtheme").css("background-image","url("+J+")")}else{J="";if(aL){zm(".zmviewport .zmbgtheme").css("background-image",J)}}}else{zm(".zmviewport .zmbgtheme").css("background-image","")}if(H!=""&&H!="none"){zm(".zmviewport .zmbgtheme").css("background-color",H)}else{H="";if(aL){zm(".zmviewport .zmbgtheme").css("background-color",H)}}zmTheme.changeCss("remove")}function Q(){zmTheme.setCurrentCover(T);zmTheme.setCurrentBackground(J);zmTheme.setCurrentBackgroundColor(H);zmTheme.setCurrentCss("")}function Z(){T="";J="";H=""}function q(){aH=null;aD=null;a=null;v=null;C=-1;S=-1;an=null;X=null;az=null;F=null;z=-1;zm(".pfcover_img .cover_img").css("top","0px")}function al(){if(T){var aL=new Image();aL.onload=function(){aL.onload=null;a=aL;v="image/jpeg"};aL.src=T}}function o(){if(J){var aL=new Image();aL.onload=function(){aL.onload=null;az=aL;F="image/jpeg"};aL.src=J}}function aa(){if(T&&(t||x||j)){return true}return false}function I(){t=false;x=false;j=false}function at(){return t}function N(aL){t=aL}function h(){zm(".zmviewport").on("mousedown",".prftheme_library .prftheme_content .move_cover_overlap",function(aL){if(t){y=true;B=aL.clientY}});zm(".zmviewport").on("mouseup",".prftheme_library .prftheme_content .move_cover_overlap",function(aL){if(t){y=false}});zm(".zmviewport").on("mousemove",".prftheme_library .prftheme_content .move_cover_overlap",function(aM){if(t&&y){var aL=aM.clientY-B;B=aM.clientY;aw+=aL;if(aw>0){aw=0}if(Math.abs(aw)>Math.floor(a.height*S-b)){aw=-Math.floor(a.height*S-b)}ap();U()}})}function ax(){zm(".zmviewport").on("mousedown",".zm_pfcover .pfctncover",function(aL){if(t){aq=true;ac=aL.clientY}});zm(".zmviewport").on("mouseup",".zm_pfcover .pfctncover",function(aL){if(t){aq=false}});zm(".zmviewport").on("mousemove",".zm_pfcover .pfctncover",function(aM){if(t&&aq){var aL=aM.clientY-ac;ac=aM.clientY;s+=aL;if(s>0){s=0}if(Math.abs(s)>Math.floor(a.height*C-L)){s=-Math.floor(a.height*C-L)}c();U()}})}function R(){zm(".zmviewport").on("click","#HideAvatarToPreviewButton",function(aM){var aL=zm("#HideAvatarToPreviewInput").attr("checked");af(aL)})}function ag(){zm(".zmviewport").on("click",".zm_pfcover .gapmoving_tool a",function(aL){aL.preventDefault();aL.stopPropagation();if(t){if(zm(this).hasClass("moving_up")){s-=1}else{s+=1}if(s>0){s=0}if(Math.abs(s)>Math.floor(a.height*C-L)){s=-Math.floor(a.height*C-L)}c();U()}})}function ab(){zm(".zmviewport").on("click",".prftheme_library #UploadCoverButton",function(aL){zm(".prftheme_library #UploadCoverInput").click();zmTheme.hideAllMessage()});zm(".zmviewport").on("change",".prftheme_library #UploadCoverInput",function(aO){var aM=zm(this),aN=aM.attr("files")[0];if(aN){if(aN.type.match(D)){var aL=new FileReader();aL.onload=function(){aL.onload=null;var aP=new Image();aP.onload=function(){aP.onload=null;if(aN.size>l){zmTheme.showMessage("warning","Ảnh vượt quá dung lượng cho phép. Tối đa: 5 MB.")}else{if(aP.width<G||aP.height<L){zmTheme.showMessage("warning","Yêu cầu ảnh có kích thước tối thiểu: 980 x 300.")}else{if(aP.width/aP.height>(G/L)){zmTheme.showMessage("warning","Ảnh không đúng tỉ lệ quy định.")}else{aC(aP);v=aN.type;T=aP.src;var aR=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.cover_column");if(aR.length){var aQ=aR.find(".thcustom_col_inner");if(aQ.length){aQ.empty();aQ.html(W(T))}}n(true);t=true;w(true);zmTheme.hideAllMessage()}}}};aP.src=aL.result};aL.readAsDataURL(aN)}else{zmTheme.showMessage("warning","Ảnh không đúng định dạng quy định. Yêu cầu: PNG/JPG.")}}})}function aI(){zm(".zmviewport").on("click",".prftheme_library #UploadBackgroundButton",function(aL){zm(".prftheme_library #UploadBackgroundInput").click();zmTheme.hideAllMessage()});zm(".zmviewport").on("change",".prftheme_library #UploadBackgroundInput",function(aO){var aM=zm(this),aN=aM.attr("files")[0];if(aN){if(aN.type.match(au)){var aL=new FileReader();aL.onload=function(){aL.onload=null;var aP=new Image();aP.onload=function(){aP.onload=null;if(aN.size>ae){zmTheme.showMessage("warning","Ảnh vượt quá dung lượng cho phép. Tối đa: 5 MB.")}else{if(aP.width<O||aP.height<m){zmTheme.showMessage("warning","Yêu cầu ảnh có kích thước tối thiểu: 1000 x 300.")}else{Y(aP);F=aN.type;J=az.src;var aT=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.background_column");if(aT.length){var aS=aT.find(".thcustom_col_inner");if(aS.length){aS.empty();aS.html(k(J))}}var aR=ao(az);H=zmTheme.rgbToHex(aR[0],aR[1],aR[2]);var aQ=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.bgcolor_column");if(aQ.length){var aU=aQ.find(".thcustom_col_inner");if(aU.length){aU.empty();aU.html(r(H,H))}}zm("#ColorCodeCustomInput").val(H);ar=true;x=true;j=true;w(true);zmTheme.hideAllMessage()}}};aP.src=aL.result};aL.readAsDataURL(aN)}else{zmTheme.showMessage("warning","Ảnh không đúng định dạng quy định. Yêu cầu: PNG/JPG.")}}})}function aG(){zm(".zmviewport").on("click","#DontUseBackgroundButton",function(aM){var aL=zm("#DontUseBackgroundInput").attr("checked");if(aL){ar=true}else{ar=false}x=true;w(true)})}function A(){zm(".zmviewport").on("click",".prftheme_library .enter_colorcode a.del_colorcode",function(aL){aL.preventDefault();zm(".prftheme_library .select_colorcode li a.colorswch_cell").removeClass("selected");zm(".prftheme_library #ColorCodeSuggestDisplay").removeClass("selected");zm("#ColorCodeCustomInput").val("");zm("#ColorCodeCustomDisplay").removeClass("selected");if(H!=""){j=true}H="";w(true)})}function P(){zm(".zmviewport").on("click",".prftheme_library .select_colorcode li a.colorswch_cell",function(aO){aO.preventDefault();var aM=zm(this),aN=aM.parents(".select_colorcode"),aL;aN.find("li a").removeClass("selected");zm(".prftheme_library #ColorCodeSuggestDisplay").removeClass("selected");aM.addClass("selected");aL=aM.attr("color");if(H!=aL){j=true}H=aL;zm("#ColorCodeCustomInput").val(H);zm("#ColorCodeCustomDisplay").css("background-color",H);zm("#ColorCodeCustomDisplay").removeClass("selected");w(true)})}function aj(){zm(".zmviewport").on("click",".prftheme_library .suggest_color",function(aO){var aM=zm(this),aN=aM.find("#ColorCodeSuggestDisplay"),aL;zm(".prftheme_library .select_colorcode li a.colorswch_cell").removeClass("selected");aN.addClass("selected");aL=aN.attr("color");if(H!=aL){j=true}H=aL;zm("#ColorCodeCustomInput").val(H);zm("#ColorCodeCustomDisplay").css("background-color",H);zm("#ColorCodeCustomDisplay").removeClass("selected");w(true)})}function aB(){zm(".zmviewport").on("click",".prftheme_library #ColorCodeCustomInput",function(aL){zm("#ColorCodePicker").click()})}function u(){zm(".zmviewport").on("keyup",".prftheme_library #ColorCodeCustomInput",function(aL){var aM=zm(this).val().toLowerCase();if(/^#[a-f0-9]{6}$/i.exec(aM)){zm(".prftheme_library #ColorCodeSuggestDisplay").removeClass("selected");zm(".prftheme_library .select_colorcode li a.colorswch_cell").removeClass("selected");if(H!=aM){j=true}H=aM;zm("#ColorCodeCustomInput").val(H);zm("#ColorCodeCustomDisplay").css("background-color",H);zm("#ColorCodeCustomDisplay").addClass("selected");w(true)}})}function K(){zm(".zmviewport").on("change",".prftheme_library #ColorCodePicker",function(aM){var aL;zm(".prftheme_library #ColorCodeSuggestDisplay").removeClass("selected");zm(".prftheme_library .select_colorcode li a.colorswch_cell").removeClass("selected");aL=zm(this).val().toLowerCase();if(H!=aL){j=true}H=aL;zm("#ColorCodeCustomInput").val(H);zm("#ColorCodeCustomDisplay").css("background-color",H);zm("#ColorCodeCustomDisplay").addClass("selected");w(true)})}function aK(){zm(".zmviewport").on("click",".prftheme_library .pftheme_updtbtn .delthemebtn",function(aQ){aQ.preventDefault();var aR=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.cover_column");if(aR.length){var aO=aR.find(".thcustom_col_inner");if(aO.length){aO.empty();aO.html(p())}}var aN=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.background_column");if(aN.length){var aM=aN.find(".thcustom_col_inner");if(aM.length){aM.empty();aM.html(am())}}var aL=zm(".prftheme_library .zmthemelib_navcontent .thcustom_col.bgcolor_column");if(aL.length){var aP=aL.find(".thcustom_col_inner");if(aP.length){aP.empty();aP.html(e())}}Z();q();I();w(true);zmTheme.hideAllMessage()})}return{init:function(){if(zm.intval(zmConfig.viewerId)<=0||zmConfig.pageName!="profile"){return}h();ax();R();ag();ab();aI();aG();A();P();aj();aB();u();K();aK()},previewCustom:w,saveCustom:V,getData:aJ,renderTab:ai,renderLargeCoverOverlap:g,resetSelectedValues:Z,resetOtherValues:q,resetInteractStatus:I,setCoverOverlapDisplayStatus:n,getCoverInteractStatus:at,setCoverInteractStatus:N}})();zmTheme.Util={};zmTheme.Util.ColorThief=(function(){function a(f){var c,d,e,b;c=document.createElement("canvas");d=c.getContext("2d");document.body.appendChild(c);e=c.width=f.width;b=c.height=f.height;d.drawImage(f,0,0,e,b);return{clear:function(){d.clearRect(0,0,e,b)},update:function(g){d.putImageData(g,0,0)},getPixelCount:function(){return e*b},getImageData:function(){return d.getImageData(0,0,e,b)},removeCanvas:function(){c.parentNode.removeChild(c)}}}return{getColor:function(d,e){var c=zmTheme.Util.ColorThief.getPalette(d,5,e);var b=c[0];return b},getPalette:function(m,t,u){if(typeof t==="undefined"){t=10}if(typeof u==="undefined"||u<1){u=10}var l=new a(m);var d=l.getImageData();var k=d.data;var e=l.getPixelCount();var f=[];for(var o=0,n,c,p,q,s;o<e;o=o+u){n=o*4;c=k[n+0];p=k[n+1];q=k[n+2];s=k[n+3];if(s>=125){if(!(c>250&&p>250&&q>250)){f.push([c,p,q])}}}var j=MMCQ.quantize(f,t);var h=j?j.palette():null;l.removeCanvas();return h}}})();var MMCQ=(function(){var e=5,c=8-e,h=1000,m=0.75;function j(n){var q=[],o=false;function p(){q.sort(n);o=true}return{push:function(r){q.push(r);o=false},peek:function(r){if(!o){p()}if(r===undefined){r=q.length-1}return q[r]},pop:function(){if(!o){p()}return q.pop()},size:function(){return q.length},map:function(r){return q.map(r)},debug:function(){if(!o){p()}return q}}}var i={map:function(q,n){var p={};return n?q.map(function(r,o){p.index=o;return n.call(p,r)}):q.slice()},naturalOrder:function(o,n){return(o<n)?-1:((o>n)?1:0)},sum:function(q,n){var p={};return q.reduce(n?function(r,s,o){p.index=o;return r+n.call(p,s)}:function(o,r){return o+r},0)},max:function(o,n){return Math.max.apply(null,n?i.map(o,n):o)}};function a(s,o,r,n,t,q,p){var u=this;u.r1=s;u.r2=o;u.g1=r;u.g2=n;u.b1=t;u.b2=q;u.histo=p}a.prototype={volume:function(o){var n=this;if(!n._volume||o){n._volume=((n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1))}return n._volume},count:function(t){var s=this,o=s.histo;if(!s._count_set||t){var r=0,q,p,n;for(q=s.r1;q<=s.r2;q++){for(p=s.g1;p<=s.g2;p++){for(n=s.b1;n<=s.b2;n++){index=d(q,p,n);r+=(o[index]||0)}}}s._count=r;s._count_set=true}return s._count},copy:function(){var n=this;return new a(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(o){var u=this,s=u.histo;if(!u._avg||o){var x=0,r=1<<(8-e),w=0,v=0,z=0,n,t,q,p,y;for(t=u.r1;t<=u.r2;t++){for(q=u.g1;q<=u.g2;q++){for(p=u.b1;p<=u.b2;p++){y=d(t,q,p);n=s[y]||0;x+=n;w+=(n*(t+0.5)*r);v+=(n*(q+0.5)*r);z+=(n*(p+0.5)*r)}}}if(x){u._avg=[~~(w/x),~~(v/x),~~(z/x)]}else{u._avg=[~~(r*(u.r1+u.r2+1)/2),~~(r*(u.g1+u.g2+1)/2),~~(r*(u.b1+u.b2+1)/2)]}}return u._avg},contains:function(n){var o=this,p=n[0]>>c;gval=n[1]>>c;bval=n[2]>>c;return(p>=o.r1&&p<=o.r2&&gval>=o.g1&&gval<=o.g2&&bval>=o.b1&&bval<=o.b2)}};function g(){this.vboxes=new j(function(o,n){return i.naturalOrder(o.vbox.count()*o.vbox.volume(),n.vbox.count()*n.vbox.volume())})}g.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){var p=this.vboxes;for(var o=0;o<p.size();o++){if(p.peek(o).vbox.contains(n)){return p.peek(o).color}}return this.nearest(n)},nearest:function(n){var s=this.vboxes,q,p,r;for(var o=0;o<s.size();o++){p=Math.sqrt(Math.pow(n[0]-s.peek(o).color[0],2)+Math.pow(n[1]-s.peek(o).color[1],2)+Math.pow(n[2]-s.peek(o).color[2],2));if(p<q||q===undefined){q=p;r=s.peek(o).color}}return r},forcebw:function(){var q=this.vboxes;q.sort(function(s,r){return i.naturalOrder(i.sum(s.color),i.sum(r.color))});var o=q[0].color;if(o[0]<5&&o[1]<5&&o[2]<5){q[0].color=[0,0,0]}var n=q.length-1,p=q[n].color;if(p[0]>251&&p[1]>251&&p[2]>251){q[n].color=[255,255,255]}}};function d(p,o,n){return(p<<(2*e))+(o<<e)+n}function l(t){var n=1<<(3*e),p=new Array(n),q,s,r,o;t.forEach(function(u){s=u[0]>>c;r=u[1]>>c;o=u[2]>>c;q=d(s,r,o);p[q]=(p[q]||0)+1});return p}function k(o,q){var u=1000000,x=0,s=1000000,w=0,v=1000000,n=0,r,p,t;o.forEach(function(y){r=y[0]>>c;p=y[1]>>c;t=y[2]>>c;if(r<u){u=r}else{if(r>x){x=r}}if(p<s){s=p}else{if(p>w){w=p}}if(t<v){v=t}else{if(t>n){n=t}}});return new a(u,x,s,w,v,n,q)}function f(r,w){if(!w.count()){return}function o(E){var J=E+"1",I=E+"2",D,K,G,F,C,H=0;for(s=w[J];s<=w[I];s++){if(x[s]>A/2){G=w.copy();F=w.copy();D=s-w[J];K=w[I]-s;if(D<=K){C=Math.min(w[I]-1,~~(s+K/2))}else{C=Math.max(w[J],~~(s-1-D/2))}while(!x[C]){C++}H=t[C];while(!H&&x[C-1]){H=t[--C]}G[I]=C;F[J]=G[I]+1;return[G,F]}}}var n=w.r2-w.r1+1,B=w.g2-w.g1+1,y=w.b2-w.b1+1,z=i.max([n,B,y]);if(w.count()==1){return[w.copy()]}var A=0,x=[],t=[],s,q,p,v,u;if(z==n){for(s=w.r1;s<=w.r2;s++){v=0;for(q=w.g1;q<=w.g2;q++){for(p=w.b1;p<=w.b2;p++){u=d(s,q,p);v+=(r[u]||0)}}A+=v;x[s]=A}}else{if(z==B){for(s=w.g1;s<=w.g2;s++){v=0;for(q=w.r1;q<=w.r2;q++){for(p=w.b1;p<=w.b2;p++){u=d(q,s,p);v+=(r[u]||0)}}A+=v;x[s]=A}}else{for(s=w.b1;s<=w.b2;s++){v=0;for(q=w.r1;q<=w.r2;q++){for(p=w.g1;p<=w.g2;p++){u=d(q,p,s);v+=(r[u]||0)}}A+=v;x[s]=A}}}x.forEach(function(D,C){t[C]=A-D});return z==n?o("r"):z==B?o("g"):o("b")}function b(p,t){if(!p.length||t<2||t>256){return false}function u(x,D){var z=1,y=0,A;while(y<h){A=x.pop();if(!A.count()){x.push(A);y++;continue}var E=f(q,A),C=E[0],B=E[1];if(!C){return}x.push(C);if(B){x.push(B);z++}if(z>=D){return}if(y++>h){return}}}var q=l(p),r=1<<(3*e);var w=0;q.forEach(function(){w++});if(w<=t){}var s=k(p,q),n=new j(function(y,x){return i.naturalOrder(y.count(),x.count())});n.push(s);u(n,m*t);var v=new j(function(y,x){return i.naturalOrder(y.count()*y.volume(),x.count()*x.volume())});while(n.size()){v.push(n.pop())}u(v,t-v.size());var o=new g();while(v.size()){o.push(v.pop())}return o}return{quantize:b}})();var zmProfileTab=(function(){var b={},h={},f;var e="";var c=true;function a(i){if(h[i]){delete h[i];return}delete h[i];var k;for(var j in b){if(zm.inArray(i,b[j].hashes)>-1){k=j;f=true;break}}if(!k){return}zmProfile.fixSizeWhenChangeTab(c);c=true;d(k);g(k)}function g(i){zm.isFunction(b[i].callback)&&b[i].callback(zm(".pfmenutab #"+i),b[i].content,location.hash.substr(1))}function d(k){if(!b[k].content){var i=zm.createElement("DIV");zm("#profiletab_content").append(i);b[k].content=zm(i)}zm("#profiletab_content").children().hide();b[k].content.show();try{zm(e+" li a.selected").removeClass("selected").find(".pftab").hide();zm(e+" #"+k).children("a").addClass("selected").find(".pftab").show()}catch(j){}}return{ID_WALL:"profile_wall",ID_INFO:"profile_info",ID_CHART:"profile_chart",ID_FRIEND:"profile_friend",ID_PHOTO:"profile_photo",ID_GAME:"profile_game",ID_FAN:"profile_fan",ID_FRIENDREQUEST:"list_request_id",ID_INTERESTED:"profile_interested",ID_BAN:"profile_ban",ID_BLOG:"profile_blog",ID_CHATROOM:"profile_chat",DEFAULT:"profile_wall",init:function(i){e=i;zm(e+" li a .pftab").hide();if(!location.hash){location.hash="wall"}zmProfileTab.register(zmProfileTab.ID_WALL,"wall");b[zmProfileTab.ID_WALL].content=zm("#profiletab_content").children().get(0);zm(window).hashchange(function(){a(location.hash.substr(1))})},fireChooseTab:g,register:function(k,i,j){if(!b[k]){zm("#"+k).click(function(l){l.preventDefault();l.stopPropagation();if(b[k]){location.hash=b[k].hashes[0]}return false})}if(zm.isString(i)){i=[i]}b[k]={hashes:i,callback:j};!f&&i&&j&&a(location.hash.substr(1))}}})();var zmFriendLayout=(function(){var a,d,c;var b=function(e){zm(a[d].buttonSelect).removeClass("selected");zm(a[e].buttonSelect).addClass("selected");zm("div.friendpage.owner."+a[d].styleClass).removeClass(a[d].styleClass).addClass(a[e].styleClass);d=e};return{start:function(){if(c>0){for(var e=1;e<c;e++){var f=a[e];zm(f.buttonSelect).removeClass("selected");zm(f.contentSelect).hide()}zm(a[0].buttonSelect).addClass("selected");zm(a[1].contentSelect).show();d=0}},register:function(i,h,e,j){var f={};f.buttonSelect=i;f.contentSelect=h;f.index=c;f.styleClass=e;a[c]=f;var g=zm(i);g.click(function(k){if(f.index===d){return false}b(f.index);j();return false});c++},init:function(){a=[];d=0;c=0}}}());var zmProfleLocalStorageKey=(function(){var a={};a.profileFriendSubTab="profile_friend_subtab";a.friendRequest="Friend request";a.friendList="Friend list";return a}());var zmProfileCurrentPage=(function(){var a={};a.current=1;a.loadMoreUrl="";a.hasWrapper=false;a.wrapper="";a.reset=function(){a.current=1};return a}());var zmProfileSubTab=(function(){var a={};a.count=0;a.list=[];a.arrayPage={};a.arrayPage.photo={};a.arrayPage.photo_of_me={};a.arrayPage.photo.page=1;a.arrayPage.photo_of_me.page=1;a.arrayPage.photoLoaded=false;a.current=0;a.photoLoaded=false;a.register=function(c,b){a.list[a.count]=c;zm(c).click(function(f){for(var d=0;d<a.list.length;d++){zm(a.list[d]).removeClass("selected")}zm(c).addClass("selected");a.current=a.list.indexOf(c);b();f.preventDefault()});a.count++};return a}());var zmCover=(function(){var a=new zm.Boxy({title:"Cài đặt ảnh bìa cho riêng bạn",content:'<div class="pf_themecont">					<ul class="pf_themetabs clearfix">						<li><a class="selected" href="#">Từ Zing Me<span></span></a></li>						<li><a href="#">Từ Máy tính</a></li>						<li><a href="#">Tạo ảnh bìa</a></li>					</ul>					<div class="contwrapper">						<div style="display:" class="cntwrp cover_lib">							<div class="pf_themelistctn">								<div class="pf_themetopic">									<label>Chọn chủ đề:</label>									<select class="sel_themetopic">										<option>Tết Tây 2014</option>									</select>								</div>								<ul class="pf_themelist">									<li class="selected">										<span class="selectedcheck zmicn"></span>										<div class="itemtheme"><a href="#"><img width="120" height="70" src="http://stheme.zdn.vn/stpl/407_ca3d9dc7e7d7bdca41083160e584db52/thumb.jpg" alt=""></a></div>										<span class="themename">Năm mới vui vẻ</span>									</li>								</ul>								<div align="center" class="pf_themepaginator">									<ul class="paginator">										<li><a class="pager_first dis" href="#">Đầu</a></li>										<li><a class="pager_prev dis" href="#"><span></span></a></li>										<li><a href="#" class="selected">1</a></li>										<li><a href="#">2</a></li>										<li><a href="#">3</a></li>										<li><a href="#">4</a></li>										<li><a href="#">5</a></li>										<li><a class="pager_next" href="#"><span></span></a></li>										<li><a class="pager_last" href="#">Cuối</a></li>									</ul>								</div>							</div>							<div class="clr"></div>						</div>						<div style="display:none;" class="cntwrp cover_upload">							<div class="inputfile">								<label class="btn_browse">									<input type="file" value="Browse...">								</label>								<span><input type="text" id="covername" readonly="readonly" name="input-file-path"></span>							</div>							<p class="test"></p>							<p class="uploadtip">								Chỉ hỗ trợ định dạng .jpg. Dung lượng tối đa <strong>5MB</strong><br>								Chiều ngang tối thiểu <strong>980px</strong>							</p>						</div>						<div class="clr"></div>					</div>				</div>'})})();zm.ready(function(){function b(d,f,c){var e=zm(d);var g=e.html();e.html(zmCommon.stringCropper.cropHtml(g,f,c,{renderEmoticon:false}));e.fadeIn()}try{zmStickUp.register(".prf_navbar",50,"#zm_footer","sticked");zmStickUp.init()}catch(a){}if(zmConfig.ownerType===0){b(".aboutme",25,4);zm.get("/fr/friend/boxfriend?userid="+zmConfig.ownerId,{dataType:"json"},function(c){if(c.error>=0){zm("#friend_box_id").html(c.html)}});zm.get("/fr/follow/boxfollow?userid="+zmConfig.ownerId,{dataType:"json"},function(c){if(c.error>=0){zm("#follower_box_id").html(c.html)}});zmEvent.fire("profiler_start","PHOTO_BOX_REMOTE");zm.get("/pht/ajax?action=profilegetalbum&ownerId="+zmConfig.ownerId+"&ownerName="+zmConfig.ownerName,{dataType:"json"},function(c){if(c.error>=0){var d=zm("#photo_box_id");if(c.count>0){zm("#profile_photo a").append(" <b> "+c.count+"</b>");d.html(c.html);zm("#my_album_url_id").attr("href","/jpt/myalbum/"+zmConfig.ownerName+"?from=appbox")}else{d.remove()}}zmEvent.fire("onRenderPhotoBox");zmEvent.fire("profiler_end","PHOTO_BOX_REMOTE")})}if(zmConfig.ownerType>0){zmFanPageAdmin.init();zm(".prf_navbar_right.fr .btn_invitefrd").click(function(){zmFanpageInvite.show();return false});b(".aboutus_content",40,3);zmEvent.fire("profiler_start","PHOTO_BOX_REMOTE");zm.get("/pht/ajax?action=fanpagegetalbum&ownerId="+zmConfig.ownerId+"&ownerName="+zmConfig.ownerName,{dataType:"json"},function(c){var d=zm("#fp_box_album");if(c.error===0){if(c.count>0){d.html(c.html);zm("#fp_box_album").attr("href","/jpt/myalbum/"+zmConfig.ownerName+"?from=appbox");zm("#profile_photo a").append(" <b> "+c.count+"</b>")}else{d.remove()}}zmEvent.fire("onRenderPhotoBox");zmEvent.fire("profiler_end","PHOTO_BOX_REMOTE")});zmProfileTab.register(zmProfileTab.ID_FAN,["fans","ban"],function(f,d,e){zmProfileCurrentPage.reset();function c(){var i={};i.nextPage=2;function j(){var l=zm("ul.frdlist_wrapper").find("li").get(":last").attr("id");var k=parseInt(l.substr(7));return k}var h="/fr/follow/fanlist?userid="+zmConfig.ownerId+"&lastuser=";zmEvent.fire("profiler_start","FRIEND_FAN_TAB_REMOTE");zm.get("/fr/follow/fanlist?userid="+zmConfig.ownerId,{dataType:"json"},function(k){if(k.error===0){d.html(k.html);var l=d.find("a.feed_loadmorebar");if(zm("ul.frdlist_wrapper").children("li").length<12){zm("a.feed_loadmorebar").hide()}l.click(function(){zm.get(h+j(),{dataType:"json"},function(m){if(m.error===0){var n=zm(zm.createElement("div"));n.html(m.html);if(n.children("li").length<12){l.hide()}zm("ul.frdlist_wrapper").append(m.html)}});i.nextPage++;return false});if(d.find("li.frdcell").length<18){d.find(".feed_loadmorebar").hide()}}else{d.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_FAN_TAB_REMOTE")})}function g(){var i=0;var h="/b/"+zmConfig.ownerName+"/manageuser?action=";zmEvent.fire("profiler_start","FRIEND_BAN_TAB_REMOTE");zm.get(h+"get",{dataType:"json"},function(j){if(j.error===0){d.html(j.data);i=j.count;zm(".unbanuser").click(function(){var k;if(this.nodeName.toLowerCase()==="a"){k=zm(this)}else{k=zm(this).parent()}zm.Boxy.confirm("Bạn có muốn hủy chặn người này",function(){var l=parseInt(k.attr("zm-data"));if(l>=0){var m={};m.userId=l;zm.post(h+"delete",m,{dataType:"json"},function(n){if(n.error===0){k.parents("li").remove();i--;if(i<=0){zm(".manage_user").html("Không có user nào bị ban trong thời gian này. ")}}})}},{title:"Thông báo",okButton:"Đồng ý",cancelButton:"Hủy"});return false});zm("#list_fan_id").click(function(){location.hash="fans";return false})}else{d.html("Có lỗi xảy ra vui lòng thử lại!")}zmEvent.fire("profiler_end","FRIEND_BAN_TAB_REMOTE")})}if(d.find("#list_fan_id").length>0){d.find(".prf_bodycontent.clearfix").html('<p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>')}switch(e){case"fans":c();break;case"ban":g();break}});zmProfileTab.register(zmProfileTab.ID_CHART,["logaccess","logfollow"],function(j,d,h){function g(){zm("#fanpage_access_log_id").click(function(){location.hash="logaccess";return false});zm("#fanpage_follow_log_id").click(function(){location.hash="logfollow";return false})}function c(){if(zmProfileCurrentPage.chartLoaded>0){d.find("div.prf_subnav.clearfix").after('<p id="remove_after_load" class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>')}else{d.prepend('<p id="remove_after_load" class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>')}}function i(){}function f(){var k="/b/"+zmConfig.ownerName+"/chart?type=access";c();zmEvent.fire("profiler_start","FRIEND_LOG_ACCESS_TAB_REMOTE");zm.get(k,{dataType:"json"},function(l){zm("#remove_after_load").remove();if(l.error===0){d.html(l.data);zm("#fanpage_access_log_id").addClass("selected");zm("#fanpage_follow_log_id").removeClass("selected");g();zmProfileCurrentPage.chartLoaded=1}else{d.html("Có lỗi xảy ra vui lòng thử lại!")}zmEvent.fire("profiler_end","FRIEND_LOG_ACCESS_TAB_REMOTE")})}function e(){var k="/b/"+zmConfig.ownerName+"/chart?type=follow";c();zmEvent.fire("profiler_start","FRIEND_LOG_FOLLOW_TAB_REMOTE");zm.get(k,{dataType:"json"},function(l){zm("#remove_after_load").remove();if(l.error===0){d.html(l.data);zm("#fanpage_access_log_id").removeClass("selected");zm("#fanpage_follow_log_id").addClass("selected");g();zmProfileCurrentPage.chartLoaded=1}else{d.html("Có lỗi xảy ra vui lòng thử lại!")}zmEvent.fire("profiler_end","FRIEND_LOG_FOLLOW_TAB_REMOTE")})}switch(h){case"logaccess":f();break;case"logfollow":e();break}})}zmProfile.getHitCounter();zm(".zm_pfcover .pfctnusername .username").attr("data-uid",zmConfig.ownerId);zmCommon.VipUser.fillAll(".zm_pfcover .pfctnusername .username");zmProfileTab.init(".prf_navbar");zmProfileTab.register(zmProfileTab.ID_FRIEND,["friend","friend/request"],function(h,f,g){var c=function(){zm("a.feed_loadmorebar").click(function(){zmProfileCurrentPage.current++;zm.get(zmProfileCurrentPage.loadMoreUlr+zmProfileCurrentPage.current,{dataType:"json"},function(i){if(i.error===0){if(!i.html){zm("a.feed_loadmorebar").hide()}else{var j=zm(zm.createElement("div"));j.html(i.html);if(j.children("li").length<12){zm("a.feed_loadmorebar").hide()}zm("ul.frdlist_wrapper.clearfix").append(i.html)}}else{if(i.error===-10){zm("a.feed_loadmorebar").hide()}else{f.append("Có lỗi xảy ra, vui lòng thử lại sau")}}});return false});zmFriendLayout.init();zmFriendLayout.register("a.btn_circle.btn_layout_column",".friendpage.owner.layout_2","layout_1",function(){zm("div.zmntfrdactbtn.fr").hide();zm("a.btndelfr.zmicn18").hide()});zmFriendLayout.register("a.btn_circle.btn_layout_row",".friendpage.owner.layout_1","layout_2",function(){zm("div.zmntfrdactbtn.fr").show();zm("a.btndelfr.zmicn18").show()});zmFriendLayout.start();zm("#list_friend_id").click(function(){location.hash="friend";return false});zm("#list_request_id").click(function(){location.hash="friend/request";return false})};var e=function(l){switch(g){case"friend":f.html(zmProfileCurrentPage.wrapper);if(l){var i="/fr/friend/list?userid="+zmConfig.ownerId+"&p="+1;zm("div.friendpage.owner ul").html('<li><p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p> </li>');zmEvent.fire("profiler_start","FRIEND_TAB_REMOTE");zm.get(i,{dataType:"json"},function(n){if(n.error===0){var p=zm(zm.createElement("div"));p.html(n.html);var o=p.children("div").get(0).children("div").get(0).children("div").get(1);zm("div.friendpage.owner").html(o.html())}else{f.html("Có lỗi xảy ra, vui lòng thử lại sau")}if(f.find("li.frdcell").length<12){f.find(".feed_loadmorebar").hide()}zmEvent.fire("profiler_end","FRIEND_TAB_REMOTE")})}zmProfileCurrentPage.reset();try{zm("a#list_friend_id").addClass("selected");zm("a#list_request_id").removeClass("selected")}catch(k){}var j="/fr/friend/list?userid="+zmConfig.ownerId+"&p=";zmProfileCurrentPage.loadMoreUlr=j;c();break;case"friend/request":f.html(zmProfileCurrentPage.wrapper);zmProfileCurrentPage.reset();var m="/fr/request/list?userid="+zmConfig.ownerId+"&p=";zmProfileCurrentPage.loadMoreUlr=m;var j="/fr/request/list?userid="+zmConfig.ownerId;try{zm("a#list_friend_id").removeClass("selected");zm("a#list_request_id").addClass("selected")}catch(k){}c();zm("div.friendpage.owner ul").html('<li><p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p> </li>');zmEvent.fire("profiler_start","FRIEND_REQUEST_TAB_REMOTE");zm.get(j,{dataType:"json"},function(p){if(p.error===0){var o=zm(zm.createElement("div"));o.html(p.html);var n=o.children("div").children("ul");zm("div.friendpage ul").html(n.html());zm("ul.frdlist_wrapper.clearfix").show();if(n.children("li").length<12){zm("a.feed_loadmorebar").hide()}}if(p.error===-10){zm("ul.frdlist_wrapper.clearfix").html("<li>"+p.html+"</li>");zm("a.feed_loadmorebar").hide()}if(f.find("li.frdcell").length<12){f.find(".feed_loadmorebar").hide()}zmEvent.fire("profiler_end","FRIEND_REQUEST_TAB_REMOTE")});break;default:break}};if(!zmProfileCurrentPage.hasWrapper){var d="/fr/friend/list?userid="+zmConfig.ownerId+"&p="+1;f.html('<p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>');zmEvent.fire("profiler_start","FRIEND_TAB_REMOTE");zm.get(d,{dataType:"json"},function(i){if(i.error===0){if(zmConfig.ownerId!==zmConfig.viewerId){zm("#list_request_id").hide()}f.html(i.html);zm("div.friendpage.owner").attr("id","friend_ul_outer");zmProfileCurrentPage.hasWrapper=true;zmProfileCurrentPage.wrapper=i.html;e()}else{f.html("Có lỗi xảy ra, vui lòng thử lại sau")}if(f.find("li.frdcell").length<12){f.find(".feed_loadmorebar").hide()}zmEvent.fire("profiler_end","FRIEND_TAB_REMOTE")})}else{e(true)}});zmProfileTab.register(zmProfileTab.ID_INTERESTED,"likes",function(f,e){zmProfileCurrentPage.reset();var d={};d.nextPage=2;var c="/fr/follow/list?userid="+zmConfig.ownerId+"&p=";zmEvent.fire("profiler_start","FRIEND_INTERESTED_TAB_REMOTE");zm.get(c+1,{dataType:"json"},function(g){if(g.error===0){e.html(g.html);var h=e.find("a.feed_loadmorebar");if(zm("ul.frdlist_wrapper").children("li").length<12){zm("a.feed_loadmorebar").hide()}h.click(function(){zm.get(c+d.nextPage,{dataType:"json"},function(i){if(i.error===0){var j=zm(zm.createElement("div"));j.html(i.html);if(j.children("li").length<12){h.hide()}zm("ul.frdlist_wrapper").append(i.html)}});d.nextPage++;return false})}else{e.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_INTERESTED_TAB_REMOTE")})});zmProfileTab.register(zmProfileTab.ID_INFO,["info","setting","privacy"],function(h,e,f){function c(){var i="/prest/"+zmConfig.ownerName+"/info";zmEvent.fire("profiler_start","FRIEND_INFO_TAB_REMOTE");zm.get(i,{dataType:"json"},function(k){if(k.error===0){e.html(k.html);e.find(".editinf").click(function(){location.hash="setting";return false});var j={};j.title="Chỉnh sửa thông tin";j.titleIcon=true;j.boxyClass="pu_larger pu_sharedtofriend";j.okButton="Cập nhật";j.cancelButton="Hủy bỏ";j.cancelClass="cancelbtn zmbtndefault";j.okClass="submitbtn zmbtn2";var l=0;var n="basic";j.onOk=function(){var w={};switch(l){case 0:w.st_gender=zm("#st_gender").val();w.st_dob=zm("#st_dob").val();w.st_mob=zm("#st_mob").val();w.st_yob=zm("#st_yob").val();w.st_fullname=zm("#st_fullname").val();w.st_mobile=zm("#st_mobile_user_id").val();w.st_personalid=zm("#st_personal_user_id").val();n="basic";break;case 1:w.st_address=zm("#st_address").val();w.st_email=zm("#st_email").val();n="contact";break;case 2:w.st_about=zm("#st_about").val();n="about";break}var v="/u/"+zmConfig.ownerName+"/edit?signkey="+zmConfig.token+"&timepost="+zmConfig.time+"&box="+n;zm.post(v,w,{dataType:"json"},function(x){if(x.error>=0){o.showSuccessMessage(x.data);setTimeout(function(){o.close();document.location.reload(true)},2000)}else{o.showErrorMessage(x.data)}});return false};var o=new zm.Boxy(j);var p="/prest/"+zmConfig.ownerName+"/editbox?signkey="+zmConfig.token+"&timepost="+zmConfig.time;var q=[];function m(w){w=parseInt(w);for(var v=0;v<q.length;v++){zm(q[v].content).hide();zm(q[v].tab).removeClass("selected")}zm(q[w].content).show();zm(q[w].tab).addClass("selected");l=w}var u={},t={},s={};u.tab="#prfupdt_tab1";u.content="div.prfupdt_form.basic_info";q.push(u);t.tab="#prfupdt_tab2";t.content="div.prfupdt_form.contact_info";q.push(t);s.tab="#prfupdt_tab3";s.content="div.prfupdt_form.yourbrief_info";q.push(s);function r(){for(var w=0;w<q.length;w++){var v=q[w];zm(v.tab).attr("data-index",w);zm(v.tab).click(function(x){m(zm(x.target).attr("data-index"));return false})}}zm("#edit_basic_id").click(function(v){zm.get(p,{dataType:"json"},function(w){if(w.error>=0){o.setContent(w.data);o.show();m(0);r()}});return false});zm("#edit_contact_id").click(function(v){zm.get(p,{dataType:"json"},function(w){if(w.error>=0){o.setContent(w.data);o.show();m(1);r()}});return false});zm("#edit_about_id").click(function(v){zm.get(p,{dataType:"json"},function(w){if(w.error>=0){o.setContent(w.data);o.show();m(2);r()}});return false})}else{e.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_INFO_TAB_REMOTE")})}function d(){var i="/prest/"+zmConfig.ownerName+"/setting?signkey="+zmConfig.token+"&timepost="+zmConfig.time;zmEvent.fire("profiler_start","FRIEND_SETTING_TAB_REMOTE");zm.get(i,{dataType:"json"},function(j){if(j.error===0){e.html(j.data);e.find(".submitbtn.zmbtn2").click(function(){var l={};l.st_gender=zm("#st_gender").val();l.st_dob=zm("#st_dob").val();l.st_mob=zm("#st_mob").val();l.st_yob=zm("#st_yob").val();l.st_fullname=zm("#st_fullname").val();l.st_mobile=zm("#st_mobile_user_id").val();l.st_personalid=zm("#st_personal_user_id").val();l.st_address=zm("#st_address").val();l.st_email=zm("#st_email").val();l.st_about=zm("#st_about").val();var k="/prest/"+zmConfig.ownerName+"/save?signkey="+zmConfig.token+"&timepost="+zmConfig.time;zm.post(k,l,{dataType:"json"},function(m){if(m.error>=0){location.hash="info"}else{if(m.data){zm.Boxy.alert(m.data,"Thông báo",3000)}else{zm.Boxy.alert("Có lỗi trong quá trình xử lý, xin thử lại!","Thông báo",3000)}}});return false})}else{e.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_SETTING_TAB_REMOTE")})}function g(){var j="/prest/"+zmConfig.ownerName+"/privacy?signkey="+zmConfig.token+"&timepost="+zmConfig.time;var i="/prest/"+zmConfig.ownerName+"/setprivacy?signkey="+zmConfig.token+"&timepost="+zmConfig.time;zmEvent.fire("profiler_start","FRIEND_PRIVACY_TAB_REMOTE");zm.get(j,{dataType:"json"},function(k){if(k.error===0){e.html(k.data);zm("#cancel_setting_privacy").click(function(){location.hash="wall";return false});zm(".showhide_icon.toggle-collapse").each(function(){var l=zm(this);l.click(function(){var m=l.parent().parent().parent();if(m.hasClass("collapsed")){m.removeClass("collapsed");zm("#"+l.attr("ref")).hide()}else{m.addClass("collapsed");zm("#"+l.attr("ref")).show()}return false})});zm("#save_privacy").click(function(){var l={};l=zmProfile.getFormData("setting_privacy_form_id");zm.post(i,l,{dataType:"json"},function(m){if(m.error===0){zm.Boxy.alert("Thông tin của bạn đã được thay đổi!","Thông báo",3000)}else{zm.Boxy.alert("Có lỗi trong quá trình xử lý, xin thử lại!","Thông báo",3000)}});return false})}else{e.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_PRIVACY_TAB_REMOTE")})}switch(f){case"info":c();break;case"setting":d();break;case"privacy":g();break}});zmProfileTab.register(zmProfileTab.ID_CHATROOM,"chatroom",function(e,d){zmProfileCurrentPage.reset();var c="/abc/"+zmConfig.ownerId;zm.get(c,{dataType:"json"},function(f){if(f.error===0){d.html(f.html)}else{d.html("Có lỗi xảy ra, vui lòng thử lại sau")}})});zmProfileTab.register(zmProfileTab.ID_BLOG,["blogs"],function(f,d,e){var c="/b/"+zmConfig.ownerName+"/blogs?page=1";d.html('<p class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>');zmEvent.fire("profiler_start","FRIEND_BLOG_TAB_REMOTE");zm.get(c,{dataType:"json"},function(g){if(g.error===0){d.html(g.data)}else{d.html("Có lỗi xảy ra, vui lòng thử lại sau")}zmEvent.fire("profiler_end","FRIEND_BLOG_TAB_REMOTE")})});zmProfileTab.register(zmProfileTab.ID_PHOTO,["photo","photo_of_me"],function(e,k,i){zmProfileSubTab.arrayPage.photo.page=1;zmProfileSubTab.arrayPage.photo_of_me.page=1;var d="/pht/ajax?action=profiletab&";var f={};f.ownerId=zmConfig.ownerId;f.ownerName=zmConfig.ownerName;function n(){zm(".photoalb_wrapper .cover_subnav .zmbtn2").click(function(u){u.preventDefault();var t=zm(u.target);var q=t.parents(".photoalb_wrapper");var p=parseInt(q.attr("zm-data"));var r=zm('input[name="vradiolist_'+p+'"]:checked').attr("value");var s={};r=parseInt(r);s.privacy=r;s.aid=p;s.password="";if(r===0){if(!q.find(".txtinput").val()){q.find(".txtinput").addClass("error");return false}s.password=q.find(".txtinput").val()}d="/jpt/ajx/"+zmConfig.ownerName+"/ialbum/updateprivacy/tk/748dfe8f2f717cbf837d2e0b2b0b7875";zm.post(d,s,{dataType:"json"},function(){q.find(".cover_navbar_btn.coverbtn_albsetting").click()});return false});zm(".photoalb_wrapper .cover_subnav .zmbtndefault").click(function(r){var q=zm(r.target);var p=q.parents(".photoalb_wrapper");p.find(".cover_navbar_btn.coverbtn_albsetting").click()});zm(".cover_navbar_btn.coverbtn_albsetting").click(function(){var p=this;var r;if(this.nodeName.toLowerCase()==="a"){r=zm(p)}else{r=zm(p.parentNode)}var q=r.parents(".photoalb_wrapper");if(q.hasClass("selected")){q.removeClass("selected");r.parent().find(".cover_subnav").hide()}else{q.addClass("selected");r.parent().find(".cover_subnav").show()}return false});zm(".cover_navbar_btn.coverbtn_editalb").click(function(){return false});zm(".zmicn16.dislike_icn").click(function(){return false});zm(".zmicn16.reshare_icn").click(function(){return false});zm(".zmicn16.like_icn").click(function(){var p="/jpt/ajx//vote/set/tk/748dfe8f2f717cbf837d2e0b2b0b7875?af=1";var q={};var s=parseInt(zm(this).attr("zm-data"));var r=zm(this);q.iid=s;q.jpt=s;q.t="album";if(location.hostname==="me.zing.vn"){zm.post(p,q,{dataType:"json"},function(t){r.removeClass("like_icn").addClass("dislike_icn");try{zm(".likecount_"+s).html(parseInt(zm(".likecount_"+s).text())+1)}catch(u){}})}else{zm.post(p,q,function(t){r.removeClass("like_icn").addClass("dislike_icn");try{zm(".likecount_"+s).html(parseInt(zm(".likecount_"+s).text())+1)}catch(u){}})}return false})}function c(){zm(".zmicn16.dislike_icn").click(function(){var t=parseInt(zm(this).attr("zm-data"));var s=zm(this);var r={pid:t,oname:zmConfig.ownerName,sign:zmConfig.token,ts:zmConfig.time};var p="/jpt/ajx/"+zmConfig.viewerName+"/vote2/";var q;if(s.hasClass("dislike_icn")){q="unset"}else{q="set"}zm.post(p+q,r,{dataType:"json"},function(u){if(u.error===0){if(q==="set"){s.removeClass("like_icn").addClass("dislike_icn");zm(".likecount_"+t).html(parseInt(zm(".likecount_"+t).text())+1)}else{s.removeClass("dislike_icn").addClass("like_icn");zm(".likecount_"+t).html(parseInt(zm(".likecount_"+t).text())-1)}}});return false});zm(".zmicn16.reshare_icn").click(function(){return false});zm(".zmicn16.like_icn").click(function(){var t=parseInt(zm(this).attr("zm-data"));var s=zm(this);var r={pid:t,oname:zmConfig.ownerName,sign:zmConfig.token,ts:zmConfig.time};var q;if(s.hasClass("dislike_icn")){q="unset"}else{q="set"}var p="/jpt/ajx/"+zmConfig.viewerName+"/vote2/";zm.post(p+q,r,{dataType:"json"},function(u){if(u.error===0){if(q==="set"){zm(".likecount_"+t).html(parseInt(zm(".likecount_"+t).text())+1);s.removeClass("like_icn").addClass("dislike_icn")}else{s.removeClass("dislike_icn").addClass("like_icn");zm(".likecount_"+t).html(parseInt(zm(".likecount_"+t).text())-1)}}});return false})}function g(){var p=zm(".prf_subnav.clearfix");var q=p.find("ul.prf_subnav_menu.clearfix");q.find(".my_album_subtab").click(function(r){r.preventDefault();location.hash="photo";return false});q.find(".photo_of_me_subtab").click(function(r){r.preventDefault();location.hash="photo_of_me";return false})}function l(r,t){var p={};p.ownerId=zmConfig.ownerId;p.ownerName=zmConfig.ownerName;p.page=zmProfileSubTab.arrayPage.photo_of_me.page;var q=zm("ul.prf_photoalb_list");q.after('<p id="remove_after_load" class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>');zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden");var s="/pht/ajax?action=photo_of&";if(p.page<1){q.fadeOut()}zm.get(s,p,{dataType:"json"},function(u){if(u.error===0){zmProfileSubTab.arrayPage.photo_of_me.page++;q.append(u.data);q.show();c();if(u.count>=12){if(zm(".feed_loadmorebar.photo_tab").length<1){q.after('<a class="feed_loadmorebar photo_tab" href="#"><span class="zmicn16"></span>Xem thêm</a>')}else{zm("a.feed_loadmorebar.photo_tab").css("visibility","visible")}}else{if(u.count===0){zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden");if(p.page===1){q.after("<br/><p>Danh sách hình đã hết hoặc bạn không có quyền xem mục này.</p>")}}else{if(p.page!==1){zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden")}}}if(zm.isFunction(t)){t()}}else{q.after("<br/>Có lỗi xảy ra hoặc bạn không có quyền xem mục này, xin vui lòng thử lại!")}zm("#remove_after_load").remove()})}function m(s,t){var q={};q.ownerId=zmConfig.ownerId;q.ownerName=zmConfig.ownerName;q.type="inner";q.page=zmProfileSubTab.arrayPage.photo.page;var r=zm("ul.prf_photoalb_list");r.after('<p id="remove_after_load" class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>');if(q.page<1){r.fadeOut()}var p="/pht/ajax?action=profiletab&";zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden");zm.get(p,q,{dataType:"json"},function(u){if(u.error===0){r.append(u.data);r.show();n();zmProfileSubTab.arrayPage.photo.page++;if(u.count>=12){if(zm(".feed_loadmorebar.photo_tab").length<1){r.after('<a class="feed_loadmorebar photo_tab" href="#"><span class="zmicn16"></span>Xem thêm</a>')}else{zm("a.feed_loadmorebar.photo_tab").css("visibility","visible")}}else{if(u.count===0){zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden");if(q.page===1){r.after("<br/><p>Danh sách album đã hết hoặc bạn không có quyền xem mục này.</p>")}}else{if(q.page!==1){zm("a.feed_loadmorebar.photo_tab").css("visibility","hidden")}}}if(zm.isFunction(t)){t()}}else{r.after("<br/>Có lỗi xảy ra, xin vui lòng thử lại!")}zm("#remove_after_load").remove()})}function j(p,q){switch(i){case"photo":m(p,q);zm(".photo_of_me_subtab").removeClass("selected");zm(".my_album_subtab").addClass("selected");break;case"photo_of_me":l(p,q);zm(".photo_of_me_subtab").addClass("selected");zm(".my_album_subtab").removeClass("selected");break}}function h(){zm(".feed_loadmorebar.photo_tab").click(function(){j(1);return false})}if(!zmProfileSubTab.arrayPage.photoLoaded||zm("ul.prf_photoalb_list")<=0){f.type="outer";k.html('<p id="remove_after_load" class="zmloading32"><em></em><span>Đang tải dữ liệu...</span></p>');zm.get(d,f,{dataType:"json"},function(p){if(p.error===0){k.html(p.data);j(1,h);g();zmProfileSubTab.arrayPage.photoLoaded=true}else{k.html("Có lỗi xảy ra, vui lòng thử lại sau")}zm("#remove_after_load").remove()})}else{var o=k.find(".zmsubpage_wrapper.prfphoto_wrapper");o.html('<ul class="prf_photoalb_list clearfix"></ul>');j(1,h);g()}});zmProfileTab.register(zmProfileTab.ID_GAME,"game",function(e,d){zmProfileCurrentPage.reset();var c="/abc/"+zmConfig.ownerId;zm.get(c,{dataType:"json"},function(f){if(f.error===0){d.html(f.html)}else{d.html("Có lỗi xảy ra, vui lòng thử lại sau")}})})},-1);