
window.addEventListener("buildUserInfo",function(b){if(MP3.BANNER_OFF!=1&&typeof(Ads)==="object"){var c="";c='<div class="_bannerAds"><div class="ads">';c+='<div class="widget widget-banner _adsCol">';c+='<div id="_mp3_adsZoneRight1" class="_adsZone ads-300-250">';c+="</div>";c+="</div>";c+='<div class="widget widget-banner _adsCol">';c+='<div id="_mp3_adsZoneRight2" class="_adsZone ads-300-250">';c+="</div>";c+="</div>";c+="</div></div>";$("#zone-ads-banner-container").html(c);Ads.setZoneRight1();Ads.setZoneRight2()}if(typeof MP3!=="undefined"&&MP3.BANNER_OFF!=1&&typeof Ads!="undefined"){var a="";a='<div id="_zoneBackgroundLeft">';a+="</div>";a+='<div id="_zoneBackgroundRight">';a+="</div>";$("#zone-ads-background-container").html(a);Ads.setZoneBackgroundLeft();Ads.setZoneBackgroundRight()}});var player2=null;var timeoutHandle=-1;var mp3Element=document.getElementById("zplayerjs-wrapper");var xml_link=document.getElementById("zplayerjs-wrapper").getAttribute("data-xml");var initModeLoop=0;var suggestItems="";var SIZE_MEM_LISTEN=7;var url="";var title="";var link="";var media={};var DEBUG=false;var zmp3Lyrics={songId:0,isInitUpload:false,tpl:null,init:function(){$("#newLyrics form").submit(function(){zmp3Lyrics.postnew(this);return false});this.itemInit($("#lyrics"))},itemInit:function(a){$(".fn-new",a).click(function(){var b=$(this).data("new");if(typeof plupload=="undefined"){loadScript("http://static.mp3.zdn.vn/skins/zmp3-v4.2/plugins/plupload/plupload.full.min.js",function(){zmp3Lyrics.initUploadLRC("lrcUpload","lrcUploadBox");zmp3Lyrics.newBoxShow(b)})}else{zmp3Lyrics.newBoxShow(b)}return false});$(".fn-next",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-prev",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-delete",a).click(function(){var c=$("#lyrics .fn-lyrics");for(var b=0;b<c.length;b++){if(!$(c[b]).hasClass("none")){zmp3Lyrics.remove($(c[b]));break}}return false})},postnew:function(a){if(a.content.value.trim().length<200||a.content.value.trim().length>4000){zmp3UI.showMsg("Nội dung cần ít nhất 200 ký tự và tối đa 4000 ký tự!",1)}else{if(!$(a).data("processing")){$(a).data("processing",true);$.post($(a).attr("action"),$(a).serialize(),function(b){if(b.code<1){a.reset();$("#newLyrics").addClass("none");zmp3Lyrics.getLyrics(zmp3Lyrics.songId,true)}zmp3UI.showMsg(b.msg,b.code);$(a).data("processing",false)},"json")}}return false},getLyrics:function(a,b){if(a){a=a.toLowerCase()}if(this.tpl===null){this.tpl=$(".fn-lyrics")[0].cloneNode(true,true);$(this.tpl).removeClass("none")}if(b){$(".fn-lyrics"+a).remove()}if($(".fn-lyrics"+a).length<1){if(this.songId!=a||b){this.songId=a}}else{zmp3Lyrics.show($("#lyrics"+a+"1"))}},remove:function(a){$.post("/json/mydata/delete-lyrics",a.data(),function(b){if(b.code<1){$(".fn-content",a).addClass("disabled")}zmp3UI.showMsg(b.msg,b.code)},"json")},buildItem:function(f,e,a,c){a=parseInt(a)+1;var d=zmp3Lyrics.tpl.cloneNode(true,true);var b="lyrics"+f+a;$(d).attr("id",b).addClass("fn-lyrics fn-lyrics"+f).data("songid",f).data("id",e.id);$(".fn-name",d).html((e.name+" - "+e.artist).substring(0,66));$(".fn-content",d).html(e.content);$(".fn-version",d).html(a+"/"+c);$("#lyrics .fn-container").append(d);if(a<c){$(".fn-next",d).removeClass("disabled").data("item","#lyrics"+f+(a+1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-next",d).addClass("disabled")}if(a>1){$(".fn-prev",d).removeClass("disabled").data("item","#lyrics"+f+(a-1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-prev",d).addClass("disabled")}$(".fn-user",d).html(e.user);$(d).append('<i class="fn_zme_info fn'+e.user+'" style="display: none;" data-ref=".fn'+e.user+'" data_uname="'+e.user+'" data-dname="#'+b+' .fn-user"></i>');$("#lyrics .fn-container").append(d)},show:function(a){$(".fn-lyrics").addClass("none");if($(".fn-content",a).html().length<10){$(".fn-nolyrics").removeClass("none");$(".fn-wlyrics").addClass("none")}else{$(".fn-nolyrics").addClass("none");$(".fn-wlyrics").removeClass("none")}a.removeClass("none");return false},newBoxShow:function(a){var c=$(".fn-playlist-item.fn-current");var b=$("#newLyrics form")[0];if(c.length>0){b.song_id.value=c.data("id");zmp3Lyrics.songId=c.data("id")}$("#newLyrics").removeClass("none");if(a=="lrc"){zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lrc"]'))}else{zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lyrics"]'))}},initUploadLRC:function(c,a){a=$("#"+a)[0];var b=new plupload.Uploader({browse_button:c,runtimes:"html5,html4",url:$("#"+c).data("url"),multi_selection:false,filters:{max_file_size:"10mb",mime_types:[{title:"LRC files",extensions:"lrc"}]},init:{FilesAdded:function(d,f){var e=$(d.settings.browse_button[0]);plupload.each(f,function(h){$(a).attr("id",h.id);$(".fn-name",a).html(h.name);$(".fn-upload-fail",a).addClass("none");$(".fn-save",a).addClass("disabled").html("Vui lòng chờ");var g=new plupload.Uploader({browse_button:"uploadTmp",runtimes:"html5,html4",url:e.data("url"),init:{UploadProgress:function(i,j){$(".fn-save",a).html("Vui lòng chờ, đang upload "+Math.floor(j.percent)+"%")},FileUploaded:function(i,k,j){j=$.parseJSON(j.response);if(!j.errorCode){$(".fn-save",a).data("filename",j.data.filename).removeClass("disabled").html("Gá»i")}},Error:function(i,j){$(".fn-upload-fail",a).removeClass("none")}}});g.init();g.addFile(h);setTimeout(function(){g.start()},200)})}}});b.init();$(".fn-save",a).click(function(){var d=$(this);if(!d.hasClass("disabled")){d.addClass("disabled").html("Vui lòng chờ");$.post(d.data("url"),d.data(),function(e){if(e.code<1){$("#newLyrics").addClass("none")}zmp3UI.showMsg(e.msg,e.code);d.html("Gửi")},"json")}return false})}};var zmp3Rec={init:function(){$(".fn-rec").click(function(){zmp3Rec.rec($(this));return false})},rec:function(b){var c=$(b.data("item"));if(!c.data("loading")){c.data("loading",true);var a=$(".fn-item",c).last()[0].cloneNode(true);$.getJSON(MP3.MP3_URL+"/json/song/get-song-suggest",c.data(),function(e){var d=$("[data-action=load-song-suggest-more]").data();if(e.error==0&&e.html){$(d.target).html(e.html);$("#block-song-suggest .load-more").addClass("none");zmp3SongTool.init()}c.data("loading",false)})}}};var zmp3Artist={init:function(){var a=$("#albumOfArtist");var b=$("#videoOfArtist");$(".fn-list",a).slick({dots:false,prevArrow:$(".fn-prev",a),nextArrow:$(".fn-next",a),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",b).slick({dots:false,prevArrow:$(".fn-prev",b),nextArrow:$(".fn-next",b),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",a).on("beforeChange",function(f,d,g,c){var e=a.data("total");if(e>d.slideCount&&d.slideCount-c<6){$.get("/json/playlist/get-album-of-artist",{id:a.data("id"),userid:a.data("uid"),start:d.slideCount,length:8},function(h){var j=$(".fn-item",a).last()[0].cloneNode(true);if(h.err==0&&h.data.albums.length>0){for(var k in h.data.albums){var m=j.cloneNode(true);var l=h.data.albums[k];m=zmp3UI.buildItem(m,l);if(l.badge){$(".fn-badge",m).addClass(l.badge)}$(".fn-list",a).slick("slickAdd",$(m))}}})}});$(".fn-list",b).on("beforeChange",function(f,d,g,c){var e=b.data("total");if(e>d.slideCount&&d.slideCount-c<6){$.get("/json/video/get-video-of-artist",{id:b.data("id"),userid:b.data("uid"),start:d.slideCount,length:8},function(h){var j=$(".fn-item",b).last()[0].cloneNode(true);if(h.err==0&&h.data.videos.length>0){for(var k in h.data.videos){var m=j.cloneNode(true);var l=h.data.videos[k];m=zmp3UI.buildItem(m,l);if(l.badge){$(".fn-badge",m).addClass(l.badge)}$(".fn-list",b).slick("slickAdd",$(m))}}})}})}};var zmp3Report={init:function(){$("input[name=_reportType]").click(function(){if($(this).val()=="other"){$("#_errorContent").removeClass("none")}else{$("#_errorContent").addClass("none")}});$("#_btnReportSubmit").click(function(){zmp3Report.sendReport($(this));return false})},sendReport:function(a){zmp3Login.show(function(){var b=true;$("input[name=_reportType]").each(function(){if($(this).prop("checked")){$(this).prop("checked",false);var c=$(this).val();if(c=="other"){c=$("#_errorContent").val()}if(c.length>5){b=false;zmp3FeedBack.post(1,c,location.href,function(d){zmp3UI.showMsg(d.msg,d.code?1:0)})}}});if(b){zmp3UI.showMsg("Vui lòng cho biết vấn đề bạn gặp phải!",1)}})}};var zmp3Like=(function(){var a=null;var f=0;var b=1;function g(j){}function c(j){$(".fn-count",a).html(zmp3Number.format(j))}function d(j){if(isNaN(MP3.ACCOUNT_ID)){MP3.ACCOUNT_ID=0}if(MP3.ACCOUNT_ID===""){window.addEventListener("buildUserInfo",function(k){$.getJSON("http://like.mp3.zing.vn/get?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",function(m){if(typeof m==="object"){var l=$(".fn-btn",a);l.html((m.like?l.html().replace("Thích","Bỏ thích"):l.html().replace("Bỏ thích","Thích")));f=m.total;c(f);if(m.like){a.data("like",1)}else{a.data("like",0)}if(j){j()}}})},false)}else{$.getJSON("http://like.mp3.zing.vn/get?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",function(l){if(typeof l==="object"){var k=$(".fn-btn",a);k.html((l.like?k.html().replace("Thích","Bỏ thích"):k.html().replace("Bỏ thích","Thích")));f=l.total;c(f);if(l.like){a.data("like",1)}else{a.data("like",0)}if(j){j()}}})}}function h(j){$.getJSON("/json/like/token?id="+a.data("id")+"&callback=?",{dataType:"json"},function(k){if(!k.error){a.data("token",k.token);a.data("key",k.key);if(j){j()}}})}function i(){d(function(){$(".fn-btn",a).click(function(){if(!MP3.ACCOUNT_ID){return zmp3Login.show(function(){zmp3Like.getToken(function(){zmp3Like.stats()})})}else{e($(this))}return false});$(".fn-count",a).click(function(){b=1;$.getJSON("http://like.mp3.zing.vn/list?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&page="+b+"&count=10&callback=?",function(j){if(j.result.total>0){g(j)}})})})}function e(){var j="";if(a.data("like")!=1){j="http://like.mp3.zing.vn/like?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?"}else{j="http://like.mp3.zing.vn/unlike?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?"}$.getJSON(j,function(l){if(typeof l==="object"&&!l.error){var k=$(".fn-btn",a);if(a.data("like")!=1){k.html(k.html().replace("Thích","Bỏ thích"));a.data("like",1);f++}else{k.html(k.html().replace("Bỏ thích","Thích"));a.data("like",0);f--}c(f)}})}return{init:function(){a=$($(".fn-zlike")[0]);if(a.length<1){return}i()},stats:function(){d()},getToken:function(j){h(j)}}})();function processJson(b,c,d,a){if(DEBUG){console.log("ajax url: ",b)}if(DEBUG){console.log("ajax data: ",c)}$.ajax({url:b,data:c,dataType:"json",success:function(e){if(DEBUG){console.log("ajax resp: ",e)}if(e instanceof Object){if(d instanceof Function){d(e)}}},error:function(f,e){if(DEBUG){console.log("ajax status: ",e)}if(DEBUG){}if(a instanceof Function){a(f,e)}}})}function trackLogListen(){try{if(typeof zmp3LogListenFlow!=="undefined"&&zmp3LogListenFlow!==null){zmp3LogListenFlow.resetLoopMode();zmp3LogListenFlow.funcTrackLogMedia(0)}else{clearTimeout(timeoutHandle);timeoutHandle=setTimeout(function(){if(typeof zmp3LogListenFlow!=="undefined"&&zmp3LogListenFlow!==null){zmp3LogListenFlow.resetLoopMode();zmp3LogListenFlow.funcTrackLogMedia(5000)}},5000)}}catch(a){console.log("Exception at zmp3LogListenFlow.onProgress: ",a)}}function isDupSuggest(){var e=$(".widget-content > ul > li");var d="";var a="";if(typeof e!=="undefined"&&e.length>0){d=e[0]}if(typeof e.data()!=="undefined"){a=e.data().id}var c=localStorage.getItem("_itemsSongListenBefore");if(c!=null){c=c.split(",");for(var b=0;b<c.length-1;b++){if(a==c[b]){return true}}}return false}function getNextSuggest(){var g=0;var f=$(".widget-content > ul > li");var b="";var e=localStorage.getItem("_itemsSongListenBefore");if(e!=null){e=e.split(",")}if(typeof f!=="undefined"&&f.length>0&&typeof f.data()!=="undefined"&&e!=null){for(var d=0;d<f.length;d++){var a=false;for(var c=0;c<e.length;c++){if($(f[d]).data().id==e[c]){a=true;break}}if(!a){g=d;break}}}return g}function updateSongListenBefore(){var c="";if(typeof zmp3LogCommon==="object"){c=zmp3LogCommon.getPageId()}var a=localStorage.getItem("_itemsSongListenBefore");if(a!=null){a=a.split(",");for(var b=0;b<a.length-1;b++){if(c==a[b]){a.splice(b,1)}}if(a.length>=(SIZE_MEM_LISTEN)){a.shift()}}else{a=[]}a.push(c);localStorage.setItem("_itemsSongListenBefore",a)}function removeFirstSuggestItem(){var b=$(".widget-content > ul > li");if(typeof b!=="undefined"&&b.length>0){var a=b[0];$(a).addClass("none")}}function replaceFirstSuggest(a){var c=$(".widget-content > ul");var b=$(".widget-content > ul > li");if(typeof c==="object"&&typeof b==="object"){c.prepend(b[a])}}function processDupSuggest(){var a=getNextSuggest();if(a!==0){replaceFirstSuggest(a)}updateSongListenBefore()}media.listen=function(){var a=$(".fn-total-play").data();processJson("/json/song/listen",{id:a.id,type:a.type},function(b){if(b.error==0&&b.total){$(".fn-total-play").html(b.total)}})};media.getSongSuggest=function(){if($("[data-action=load-song-suggest]").size()){var a=$("[data-action=load-song-suggest]").data();processJson("/json/song/get-song-suggest",{id:a.id,start:0,length:10},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3Rec.init();zmp3SongTool.init();processDupSuggest();suggestItems=$(".widget-content a.fn-link");if(suggestItems!=null&&suggestItems!=""&&suggestItems.length>0){var c=$(suggestItems[0]);if($("#songRec.widget-content .fn-item.none").length!=0){if($(suggestItems[2])!=null){c=$(suggestItems[2]);title=$($(".widget-content ul li")[1]).attr("data-name")+" - "+$($(".widget-content ul li")[1]).attr("data-artist")}}else{title=$($(".widget-content ul li")[0]).attr("data-name")+" - "+$($(".widget-content ul li")[0]).attr("data-artist")}link=c.attr("href")}}})}};media.getInfoAndDataOfArtist=function(){if($("[data-action=load-info-artist]").size()){var a=$("[data-action=load-info-artist]").data();if(a.offical===true){processJson("/json/artist/get-info.json",{id:a.id},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3Artist.init();zmp3Report.init()}media.getPlaylistCollection()})}else{processJson("/json/user/get-info.json",{id:a.id},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3Artist.init();zmp3Report.init()}media.getPlaylistCollection()})}}};media.getPlaylistCollection=function(){if($("[data-action=load-playlist-collection]").size()){var a=$("[data-action=load-playlist-collection]").data();processJson("/json/playlist/get-collection",{id:a.id,},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3UI.init();zmp3UI.init()}})}};$.get(xml_link,function(b){var g=[];var f=false;for(var d in b.data){var a=b.data[d];var e={};e.id=a.id;e.title=a.name;e.song_url=a.link;e.artist=a.artist;e.poster=a.cover!="http://zmp3-photo.d.za.zdn.vn/"?a.cover:"http://image.mp3.zdn.vn/skins/zmp3-v4/images/default2/1190x350.jpg";e.zoneId="2215645070117788516",e.msg=typeof a.msg=="undefined"?"This content is not available right now":a.msg;e.sourceLevel=[];for(var d in a.qualities){var c={};c.label=a.qualities[d]+"kbps";c.source=a.source_list[d]?a.source_list[d]:"";e.sourceLevel.push(c)}if(typeof e.sourceLevel!=="undefined"&&typeof e.sourceLevel[0]!=="undefined"){e.source=e.sourceLevel[0].source}e.karaokeUrl=a.lyric;e.mvUrl=a.mv_link}g.push(e);player2=new zPlayer.Player({product:"zingmp3",mimeType:"audio/mp3",playlist:g,playerType:"song",height:185,width:650,autoPlay:true,mute:false,volume:100,alwaysShowControl:true,requireVip:function(){if(typeof ZVip==="object"){ZVip.Fpackage(2)}}});player2.on(zPlayer.Events.PLAYER_READY,function(){trackLogListen();media.listen();media.getSongSuggest();media.getInfoAndDataOfArtist();if(typeof zmp3Lyrics==="object"){zmp3Lyrics.init()}if(typeof zmp3Like==="object"){zmp3Like.init()}if(typeof zmp3Storage==="object"&&typeof zmp3Storage.getParam("_zpAuto")=="undefined"){zmp3Storage.setParam("_zpAuto",1);$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on");player2.setSongPlayMode(1)}setTimeout(function(){if(typeof ZLog==="object"){if(MP3.LOG_INFO==""){var h=setInterval(function(){if(MP3.LOG_INFO!=""){clearInterval(h);MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}},1000)}else{MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}}else{console.log("Undefined Zlog")}},2000)});player2.on(zPlayer.Events.PLAYER_UPDATE_SONG_MODE,function(j){var i=j.playModeSong;if(initModeLoop>=2){if(i==1){$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on");zmp3Storage.setParam("_zpAuto",1)}else{$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off");zmp3Storage.setParam("_zpAuto",0)}}else{if(zmp3Storage.getParam("_zpAuto")==1){$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on")}else{$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off")}}initModeLoop++;if(typeof zmp3LogListenFlow!=="undefined"&&zmp3LogListenFlow!==null){var h=(i=="1")?1:0;zmp3LogListenFlow.setLoopMode(h)}});player2.on(zPlayer.Events.PLAYER_ENDED,function(){f=false;if(parseInt(zmp3Storage.getParam("playmodesong",0))==1&&parseInt(zmp3Storage.getParam("_zpAuto",0))==1){var i={};i.title=title;i.url=link;player2.playNext(i);setTimeout(function(){if(typeof zmp3LogListenFlow==="object"){var j=zmp3LogListenFlow.constants.LOCAL_STORAGE_LISTEN_SONG_BEFORE;zmp3LogListenFlow.updateIsAutoMedia(j,1)}if(!f){location.href=link}},8000)}if(parseInt(zmp3Storage.getParam("playmodesong",0))==0){if(typeof zmp3LogListenFlow==="object"){var h=zmp3LogListenFlow.constants.LOCAL_STORAGE_LISTEN_SONG_BEFORE;zmp3LogListenFlow.updateIsAutoMedia(h,1);trackLogListen()}}});player2.on(zPlayer.Events.PLAYER_CANTPLAY,function(){try{media.listen();media.getSongSuggest();media.getInfoAndDataOfArtist()}catch(h){console.log(h)}});player2.on(zPlayer.Events.PLAYER_PLAYITEM,function(){setTimeout(function(){if(typeof ZLog==="object"){MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}else{console.log("Undefined Zlog")}},2000)});player2.on(zPlayer.Events.PLAYER_NEXT,function(h){if(link!==""){location.href=link}});player2.on(zPlayer.Events.PLAYER_CANCEL_PLAYNEXT,function(){f=true});player2.attachTo(mp3Element);$(".page-play-song").on("click",".fn-autoplay",function(){if(parseInt(zmp3Storage.getParam("_zpAuto",0))==1){$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off");zmp3Storage.setParam("_zpAuto",0)}else{zmp3Storage.setParam("_zpAuto",1);player2.setSongPlayMode(1)}})});$(document).on("click",".fn-buy-vip",function(){ZVip.Fpackage(2)});