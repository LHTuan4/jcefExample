
window.addEventListener("buildUserInfo",function(b){if(MP3.BANNER_OFF!=1&&typeof(Ads)==="object"){var c="";c='<div class="_bannerAds"><div class="ads">';c+='<div class="widget widget-banner _adsCol">';c+='<div id="_mp3_adsZoneRight1" class="_adsZone ads-300-250">';c+="</div>";c+="</div>";c+='<div class="widget widget-banner _adsCol">';c+='<div id="_mp3_adsZoneRight2" class="_adsZone ads-300-250">';c+="</div>";c+="</div>";c+="</div></div>";$("#zone-ads-banner-container").html(c);Ads.setZoneRight1();Ads.setZoneRight2()}if(typeof MP3!=="undefined"&&MP3.BANNER_OFF!=1&&typeof Ads!="undefined"){var a="";a='<div id="_zoneBackgroundLeft">';a+="</div>";a+='<div id="_zoneBackgroundRight">';a+="</div>";$("#zone-ads-background-container").html(a);Ads.setZoneBackgroundLeft();Ads.setZoneBackgroundRight()}});var player2=null;var suggest={};var timeoutHandle=-1;var mp3Element=document.getElementById("zplayerjs-wrapper");var xml_link=document.getElementById("zplayerjs-wrapper").getAttribute("data-xml");var initModeLoop=0;var suggestItems="";var SIZE_MEM_LISTEN=7;var url="";var title="";var link="";var media={};var DEBUG=false;var zmp3Lyrics={songId:0,isInitUpload:false,tpl:null,init:function(){$("#newLyrics form").submit(function(){zmp3Lyrics.postnew(this);return false});this.itemInit($("#lyrics"))},itemInit:function(a){$(".fn-new",a).click(function(){var b=$(this).data("new");if(typeof plupload=="undefined"){loadScript("http://static.mp3.zdn.vn/skins/zmp3-v4.2/plugins/plupload/plupload.full.min.js",function(){zmp3Lyrics.initUploadLRC("lrcUpload","lrcUploadBox");zmp3Lyrics.newBoxShow(b)})}else{zmp3Lyrics.newBoxShow(b)}return false});$(".fn-next",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-prev",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-delete",a).click(function(){var c=$("#lyrics .fn-lyrics");for(var b=0;b<c.length;b++){if(!$(c[b]).hasClass("none")){zmp3Lyrics.remove($(c[b]));break}}return false})},postnew:function(a){if(a.content.value.trim().length<200||a.content.value.trim().length>4000){zmp3UI.showMsg("Nội dung cần ít nhất 200 ký tự và tối đa 4000 ký tự!",1)}else{if(!$(a).data("processing")){$(a).data("processing",true);$.post($(a).attr("action"),$(a).serialize(),function(b){if(b.code<1){a.reset();$("#newLyrics").addClass("none");zmp3Lyrics.getLyrics(zmp3Lyrics.songId,true)}zmp3UI.showMsg(b.msg,b.code);$(a).data("processing",false)},"json")}}return false},getLyrics:function(a,b){if(a){a=a.toLowerCase()}if(this.tpl===null){this.tpl=$(".fn-lyrics")[0].cloneNode(true,true);$(this.tpl).removeClass("none")}if(b){$(".fn-lyrics"+a).remove()}if($(".fn-lyrics"+a).length<1){if(this.songId!=a||b){this.songId=a}}else{zmp3Lyrics.show($("#lyrics"+a+"1"))}},remove:function(a){$.post("/json/mydata/delete-lyrics",a.data(),function(b){if(b.code<1){$(".fn-content",a).addClass("disabled")}zmp3UI.showMsg(b.msg,b.code)},"json")},buildItem:function(f,e,a,c){a=parseInt(a)+1;var d=zmp3Lyrics.tpl.cloneNode(true,true);var b="lyrics"+f+a;$(d).attr("id",b).addClass("fn-lyrics fn-lyrics"+f).data("songid",f).data("id",e.id);$(".fn-name",d).html((e.name+" - "+e.artist).substring(0,66));$(".fn-content",d).html(e.content);$(".fn-version",d).html(a+"/"+c);$("#lyrics .fn-container").append(d);if(a<c){$(".fn-next",d).removeClass("disabled").data("item","#lyrics"+f+(a+1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-next",d).addClass("disabled")}if(a>1){$(".fn-prev",d).removeClass("disabled").data("item","#lyrics"+f+(a-1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-prev",d).addClass("disabled")}$(".fn-user",d).html(e.user);$(d).append('<i class="fn_zme_info fn'+e.user+'" style="display: none;" data-ref=".fn'+e.user+'" data_uname="'+e.user+'" data-dname="#'+b+' .fn-user"></i>');$("#lyrics .fn-container").append(d)},show:function(a){$(".fn-lyrics").addClass("none");if($(".fn-content",a).html().length<10){$(".fn-nolyrics").removeClass("none");$(".fn-wlyrics").addClass("none")}else{$(".fn-nolyrics").addClass("none");$(".fn-wlyrics").removeClass("none")}a.removeClass("none");return false},newBoxShow:function(a){var c=$(".fn-playlist-item.fn-current");var b=$("#newLyrics form")[0];if(c.length>0){b.song_id.value=c.data("id");zmp3Lyrics.songId=c.data("id")}$("#newLyrics").removeClass("none");if(a=="lrc"){zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lrc"]'))}else{zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lyrics"]'))}},initUploadLRC:function(c,a){a=$("#"+a)[0];var b=new plupload.Uploader({browse_button:c,runtimes:"html5,html4",url:$("#"+c).data("url"),multi_selection:false,filters:{max_file_size:"10mb",mime_types:[{title:"LRC files",extensions:"lrc"}]},init:{FilesAdded:function(d,f){var e=$(d.settings.browse_button[0]);plupload.each(f,function(h){$(a).attr("id",h.id);$(".fn-name",a).html(h.name);$(".fn-upload-fail",a).addClass("none");$(".fn-save",a).addClass("disabled").html("Vui lòng chờ");var g=new plupload.Uploader({browse_button:"uploadTmp",runtimes:"html5,html4",url:e.data("url"),init:{UploadProgress:function(i,j){$(".fn-save",a).html("Vui lòng chờ, đang upload "+Math.floor(j.percent)+"%")},FileUploaded:function(i,k,j){j=$.parseJSON(j.response);if(!j.errorCode){$(".fn-save",a).data("filename",j.data.filename).removeClass("disabled").html("Gá»i")}},Error:function(i,j){$(".fn-upload-fail",a).removeClass("none")}}});g.init();g.addFile(h);setTimeout(function(){g.start()},200)})}}});b.init();$(".fn-save",a).click(function(){var d=$(this);if(!d.hasClass("disabled")){d.addClass("disabled").html("Vui lòng chờ");$.post(d.data("url"),d.data(),function(e){if(e.code<1){$("#newLyrics").addClass("none")}zmp3UI.showMsg(e.msg,e.code);d.html("Gửi")},"json")}return false})}};var zmp3Rec={init:function(){$(".fn-rec").click(function(){zmp3Rec.rec($(this));return false})},rec:function(b){var c=$(b.data("item"));if(!c.data("loading")){c.data("loading",true);var a=$(".fn-item",c).last()[0].cloneNode(true);$.getJSON("/json/video/get-video-recommend",c.data(),function(d){if(d.err==0){var g=parseInt(c.data("start"))+d.data.videos.length;if(g>=d.data.total){b.remove()}if(d.data.videos.length>0){c.data("start",g);for(var e in d.data.videos){var f=zmp3UI.buildItem(a.cloneNode(true),d.data.videos[e],"songrec");$(".fn-list",c).append(f)}zmp3SongTool.init()}}c.data("loading",false)})}}};var zmp3Artist={init:function(){var a=$("#albumOfArtist");var b=$("#videoOfArtist");$(".fn-list",a).slick({dots:false,prevArrow:$(".fn-prev",a),nextArrow:$(".fn-next",a),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",b).slick({dots:false,prevArrow:$(".fn-prev",b),nextArrow:$(".fn-next",b),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",a).on("beforeChange",function(f,d,g,c){var e=a.data("total");if(e>d.slideCount&&d.slideCount-c<6){$.get("/json/playlist/get-album-of-artist",{id:a.data("id"),userid:a.data("uid"),start:d.slideCount,length:8},function(h){var j=$(".fn-item",a).last()[0].cloneNode(true);if(h.err==0&&h.data.albums.length>0){for(var k in h.data.albums){var m=j.cloneNode(true);var l=h.data.albums[k];m=zmp3UI.buildItem(m,l);if(l.badge){$(".fn-badge",m).addClass(l.badge)}$(".fn-list",a).slick("slickAdd",$(m))}}})}});$(".fn-list",b).on("beforeChange",function(f,d,g,c){var e=b.data("total");if(e>d.slideCount&&d.slideCount-c<6){$.get("/json/video/get-video-of-artist",{id:b.data("id"),userid:b.data("uid"),start:d.slideCount,length:8},function(h){var j=$(".fn-item",b).last()[0].cloneNode(true);if(h.err==0&&h.data.videos.length>0){for(var k in h.data.videos){var m=j.cloneNode(true);var l=h.data.videos[k];m=zmp3UI.buildItem(m,l);if(l.badge){$(".fn-badge",m).addClass(l.badge)}$(".fn-list",b).slick("slickAdd",$(m))}}})}})}};var zmp3Report={init:function(){$("input[name=_reportType]").click(function(){if($(this).val()=="other"){$("#_errorContent").removeClass("none")}else{$("#_errorContent").addClass("none")}});$("#_btnReportSubmit").click(function(){zmp3Report.sendReport($(this));return false})},sendReport:function(a){zmp3Login.show(function(){var b=true;$("input[name=_reportType]").each(function(){if($(this).prop("checked")){$(this).prop("checked",false);var c=$(this).val();if(c=="other"){c=$("#_errorContent").val()}if(c.length>5){b=false;zmp3FeedBack.post(1,c,location.href,function(d){zmp3UI.showMsg(d.msg,d.code?1:0)})}}});if(b){zmp3UI.showMsg("Vui lòng cho biết vấn đề bạn gặp phải!",1)}})}};var zmp3Like=(function(){var a=null;var f=0;var b=1;function g(j){}function c(j){$(".fn-count",a).html(zmp3Number.format(j))}function d(j){if(isNaN(MP3.ACCOUNT_ID)){MP3.ACCOUNT_ID=0}if(MP3.ACCOUNT_ID===""){window.addEventListener("buildUserInfo",function(k){$.getJSON("http://like.mp3.zing.vn/get?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",function(m){if(typeof m==="object"){var l=$(".fn-btn",a);l.html((m.like?l.html().replace("Thích","Bỏ thích"):l.html().replace("Bỏ thích","Thích")));f=m.total;c(f);if(m.like){a.data("like",1)}else{a.data("like",0)}if(j){j()}}})},false)}else{$.getJSON("http://like.mp3.zing.vn/get?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",function(l){if(typeof l==="object"){var k=$(".fn-btn",a);k.html((l.like?k.html().replace("Thích","Bỏ thích"):k.html().replace("Bỏ thích","Thích")));f=l.total;c(f);if(l.like){a.data("like",1)}else{a.data("like",0)}if(j){j()}}})}}function h(j){$.getJSON("/json/like/token?id="+a.data("id")+"&callback=?",{dataType:"json"},function(k){if(!k.error){a.data("token",k.token);a.data("key",k.key);if(j){j()}}})}function i(){d(function(){$(".fn-btn",a).click(function(){if(!MP3.ACCOUNT_ID){return zmp3Login.show(function(){zmp3Like.getToken(function(){zmp3Like.stats()})})}else{e($(this))}return false});$(".fn-count",a).click(function(){b=1;$.getJSON("http://like.mp3.zing.vn/list?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&page="+b+"&count=10&callback=?",function(j){if(j.result.total>0){g(j)}})})})}function e(){var j="";if(a.data("like")!=1){j="http://like.mp3.zing.vn/like?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?"}else{j="http://like.mp3.zing.vn/unlike?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?"}$.getJSON(j,function(l){if(typeof l==="object"&&!l.error){var k=$(".fn-btn",a);if(a.data("like")!=1){k.html(k.html().replace("Thích","Bỏ thích"));a.data("like",1);$(".func-like").addClass("active");f++}else{k.html(k.html().replace("Bỏ thích","Thích"));a.data("like",0);$(".func-like").removeClass("active");f--}c(f)}})}return{init:function(){a=$($(".fn-zlike")[0]);if(a.length<1){return}i()},stats:function(){d()},getToken:function(j){h(j)}}})();function processJson(b,c,d,a){if(DEBUG){console.log("ajax url: ",b)}if(DEBUG){console.log("ajax data: ",c)}$.ajax({url:b,data:c,dataType:"json",success:function(e){if(DEBUG){console.log("ajax resp: ",e)}if(e instanceof Object){if(d instanceof Function){d(e)}}},error:function(f,e){if(DEBUG){console.log("ajax status: ",e)}if(DEBUG){}if(a instanceof Function){a(f,e)}}})}function getParameterByName(b,a){if(!a){a=window.location.href}b=b.replace(/[\[\]]/g,"\\$&");var d=new RegExp("[?&]"+b+"(=([^&#]*)|&|#|$)"),c=d.exec(a);if(!c){return null}if(!c[2]){return""}return decodeURIComponent(c[2].replace(/\+/g," "))}function isDupSuggest(){var e=$(".widget-content > ul > li");var d="";var a="";if(typeof e!=="undefined"&&e.length>0){d=e[0]}if(typeof e.data()!=="undefined"){a=e.data().id}var c=localStorage.getItem("_itemsSongListenBefore");if(c!=null){c=c.split(",");for(var b=0;b<c.length-1;b++){if(a==c[b]){return true}}}return false}function getNextSuggest(){var g=0;var f=$(".widget-content > ul > li");var b="";var e=localStorage.getItem("_itemsSongListenBefore");if(e!=null){e=e.split(",")}if(typeof f!=="undefined"&&f.length>0&&typeof f.data()!=="undefined"&&e!=null){for(var d=0;d<f.length;d++){var a=false;for(var c=0;c<e.length;c++){if($(f[d]).data().id==e[c]){a=true;break}}if(!a){g=d;break}}}return g}function updateSongListenBefore(){var c="";if(typeof zmp3LogCommon==="object"){c=zmp3LogCommon.getPageId()}var a=localStorage.getItem("_itemsSongListenBefore");if(a!=null){a=a.split(",");for(var b=0;b<a.length-1;b++){if(c==a[b]){a.splice(b,1)}}if(a.length>=(SIZE_MEM_LISTEN)){a.shift()}}else{a=[]}a.push(c);localStorage.setItem("_itemsSongListenBefore",a)}function removeFirstSuggestItem(){var b=$(".widget-content > ul > li");if(typeof b!=="undefined"&&b.length>0){var a=b[0];$(a).addClass("none")}}function replaceFirstSuggest(a){var c=$(".widget-content > ul");var b=$(".widget-content > ul > li");if(typeof c==="object"&&typeof b==="object"){c.prepend(b[a])}}function processDupSuggest(){var a=getNextSuggest();if(a!==0){replaceFirstSuggest(a)}updateSongListenBefore()}media.type="";media.items=[];media.curPosItem=0;media.nextPosItem=0;media.prevPosItem=0;media.repeat=0;media.init=function(){media.type=getParameterByName("type")};media.listen=function(){var a=$(".fn-total-play").data();processJson("/json/listen/get.json",{id:a.id,type:a.type},function(b){if(b.error==0&&b.total){$(".fn-total-play").html(b.total)}})};media.getInfoAndDataOfArtist=function(){if($("[data-action=load-info-artist]").size()){var a=$("[data-action=load-info-artist]").data();processJson("/json/artist/get-info.json",{id:a.id,},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3UI.init();zmp3Artist.init()}})}};media.getLyricsOfVideo=function(){if($("[data-action=load-lyrics-video]").size()){var a=$("[data-action=load-lyrics-video]").data();processJson("/json/video/get-lyrics",{id:a.id,videoname:a.videoname},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3Lyrics.init()}})}};media.getVideoSuggest=function(){if($("[data-action=load-video-suggest]").size()){var a=$("[data-action=load-video-suggest]").data();processJson("/json/video/get-video-suggest",{id:a.id,},function(b){if(b.error==0&&b.html){$(a.target).html(b.html);zmp3Rec.init();suggestItems=$(".widget-content a.fn-link");if(suggestItems!=null&&suggestItems!=""&&suggestItems.length>0){var c=$(suggestItems[0]);if($("#videoRec.widget-content .fn-item.none").length!=0){if($(suggestItems[2])!=null){c=$(suggestItems[2]);title=$($(".widget-content ul li")[1]).attr("data-name")+" - "+$($(".widget-content ul li")[1]).attr("data-artist")}}else{title=$($(".widget-content ul li")[0]).attr("data-name")+" - "+$($(".widget-content ul li")[0]).attr("data-artist")}link=c.attr("href")}if(media.type==="chart"||media.type==="fav"||media.type==="topic"||media.type==="playlist"){$(".autoplay").addClass("none")}}})}};media.getListVideoByType=function(){var c=getParameterByName("list");var a=getParameterByName("type");if(c!==""&&a!==""&&$("[data-action=load-mv-playlist]").size()){var b=$("[data-action=load-mv-playlist]").data();processJson("/json/video/get-list-video-by-type",{id:c,type:a,sort:b.sort,videoid:b.videoid,qs:b.qs},function(d){if(d.error==0&&d.html){$(".wrap-body").addClass("with-playlist");$(b.target).html(d.html);$(".fn-scrollbar").mCustomScrollbar({scrollInertia:0,scrollbarPosition:"outside",autoHideScrollbar:true,autoExpandScrollbar:true,mouseWheel:{preventDefault:true},});$(".fn-scrollbar").mCustomScrollbar("scrollTo",$(".fn-playlist-item-"+b.videoid));setTimeout(function(){if($(".fn-zlike .fn-btn").text()=="Bỏ thích"){$(".func-like").addClass("active")}else{$(".func-like").removeClass("active")}$(".func-like").on("click",function(){$(".fn-zlike .fn-btn").click()})},2000);$(document).on("click","#playlistItems .fn-repeat",function(g){if($(this).hasClass("func-repeat")){if($(this).hasClass("active")){$(this).addClass("none");$(this).removeClass("active");$(".func-repeat-one").removeClass("none");$(".func-repeat-one").addClass("active")}else{$(".func-repeat").addClass("active")}}if($(this).hasClass("func-repeat-one")){$(".func-repeat-one").addClass("none");$(".func-repeat-one").removeClass("active");$(".func-repeat").removeClass("none")}if($(this).hasClass("func-shuffle")){if($(this).hasClass("active")){$(this).removeClass("active")}else{$(this).addClass("active")}}var f=false;if($(this).hasClass("func-shuffle")){f=true}media.changeRepeat(f);return false});media.initRepeat()}})}};media.calScheduleItems=function(a){$.fn.randomize=function(d){var e=d?$(this).find(d):$(this).children(),c=e.parent();c.each(function(){$(this).children(d).sort(function(){var f=0.75;if(typeof zmp3Storage.getParam("_zmp3RandomKey")==="undefined"||a){f=Math.round(Math.random());zmp3Storage.setParam("_zmp3RandomKey",f)}else{f=zmp3Storage.getParam("_zmp3RandomKey")}return f-0.2}).detach().appendTo(this)});return this};if(media.repeat===1||media.repeat===2||media.repeat===4){$("ul.playlist-videos-list").randomize()}else{$("ul.playlist-videos-list li").sort(b).appendTo("ul.playlist-videos-list");function b(d,c){return($(c).data("order"))<($(d).data("order"))?1:-1}}media.items=$("ul.playlist-videos-list li")};media.calCurItem=function(){if((media.type==="chart"||media.type==="fav"||media.type==="topic"||media.type==="playlist")&&media.items.length>0){for(var a=0;a<media.items.length;a++){if($(media.items[a]).attr("data-id")===MP3.MEDIAID){media.curPosItem=a}}}};media.calNextPrevItem=function(){if((media.type==="chart"||media.type==="fav"||media.type==="topic"||media.type==="playlist")&&media.items.length>0){if(media.curPosItem<(media.items.length-1)){media.nextPosItem=media.curPosItem+1}else{if(media.repeat!==3){media.nextPosItem=0}else{media.nextPosItem=""}}if(media.curPosItem!==0){media.prevPosItem=media.curPosItem-1}else{media.prevPosItem=media.items.length-1}}};media.focusCurItem=function(){$(media.items[media.curPosItem]).addClass("active");var e=parseInt($("#mCSB_2_container").css("height"),10);var d=parseInt($("#mCSB_2_container ul li").css("height"),10);var f=4;var b=0;for(var a=0;a<$("ul.playlist-videos-list li").length;a++){if($($("ul.playlist-videos-list li")[a]).attr("data-id")===MP3.MEDIAID){b=a}}var c=-((d*b)>=(e-(d*f))?e-(d*f):d*b)+"px";if($("ul.playlist-videos-list li").length>4){$("#mCSB_2_container").css("top",c)}};media.initRepeat=function(){media.repeat=parseInt(zmp3Storage.getParam("_zmp3RePlMV",0));var a=zPlayer.Player.NO_REPEAT_SONG;player2.setSongMode(a);switch(media.repeat){case 0:$(".func-repeat").removeClass("none").addClass("active");$(".func-repeat-one").addClass("none").removeClass("active");$(".func-shuffle").removeClass("none").removeClass("active");break;case 1:$(".func-repeat").removeClass("none").addClass("active");$(".func-repeat-one").addClass("none").removeClass("active");$(".func-shuffle").removeClass("none").addClass("active");break;case 2:$(".func-repeat").removeClass("none").removeClass("active");$(".func-repeat-one").addClass("none").removeClass("active");$(".func-shuffle").removeClass("none").addClass("active");break;case 3:$(".func-repeat").removeClass("none").removeClass("active");$(".func-repeat-one").addClass("none").removeClass("active");$(".func-shuffle").removeClass("none").removeClass("active");break;case 4:$(".func-repeat").removeClass("active").addClass("active");$(".func-repeat-one").removeClass("none").addClass("active");var a=zPlayer.Player.REPEAT_SONG;player2.setSongMode(a);$(".func-shuffle").removeClass("none").addClass("active");break;case 5:$(".func-repeat").removeClass("active").addClass("active");$(".func-repeat-one").removeClass("none").addClass("active");var a=zPlayer.Player.REPEAT_SONG;player2.setSongMode(a);$(".func-shuffle").removeClass("none").removeClass("active");break}media.calScheduleItems();media.calCurItem();media.calNextPrevItem();media.focusCurItem()},media.changeRepeat=function(b){var a=$(".func-repeat").hasClass("active")&&!$(".func-repeat").hasClass("none");var e=$(".func-repeat-one").hasClass("active")&&!$(".func-repeat-one").hasClass("none");var d=$(".func-shuffle").hasClass("active");if(a){if(!d){media.repeat=0}else{media.repeat=1}}else{if(d){media.repeat=2}else{media.repeat=3}}if(e){if(d){media.repeat=4}else{media.repeat=5}}zmp3Storage.setParam("_zmp3RePlMV",media.repeat);var c=zPlayer.Player.NO_REPEAT_SONG;if(e){c=zPlayer.Player.REPEAT_SONG}player2.setSongMode(c);if(b){media.calScheduleItems(b)}media.calCurItem();media.calNextPrevItem();media.focusCurItem()},$.getJSON(xml_link,function(e){var c=[];var a=false;for(var g in e.data.item){var f=e.data.item[g];var m={};m.id=f.id;m.title=f.name;m.song_url=f.mp3link;m.artist=f.artist;m.poster=f.thumbnail!="http://zmp3-photo.d.za.zdn.vn/"?f.thumbnail:"http://image.mp3.zdn.vn/skins/zmp3-v4/images/default2/1190x350.jpg";m.sourceLevel=[];m.source="";for(var g in f.qualities){var k={};k.label=f.qualities[g].includes("(VIP)")?f.qualities[g]:f.qualities[g];k.source=f.source_list[g]==="require vip"?"":f.source_list[g];m.sourceLevel.push(k);if(m.source_list==""){if(typeof m.source_list!=="undefined"&&typeof m.source_list[0]!=="undefined"){m.source=m.source_list[0]}}}}if(typeof e.data.suggest.item!=="undefined"){suggest=e.data.suggest.item}c.push(m);var j=getParameterByName("type");var l=j==="chart"||j==="fav"||j==="topic"||j==="playlist"?true:false;var d=j==="chart"||j==="fav"||j==="topic"||j==="playlist"?false:true;var h="";var b="";if(typeof ZA==="object"){ZA.getVisitorID(function(i){b="&uid="+i;if(!MP3.BANNER_OFF&&!MP3.VIP){var q="";window.adtimaDynamic&&(q+=window.adtimaDynamic);var o=document.getElementById("zads-dynamic");o&&(q+=(q?";":"")+o.getAttribute("values"));try{var r=AdtimaRender.Helpers.Cookie.get("crtg_vng_rta");if(r){r+=",none";r=r.replace(/;/g,",");q+=(q?";":"")+"criteo="+r}else{q+=(q?";":"")+"criteo=none"}}catch(p){q+=(q?";":"")+"criteo=none"}try{var n=document.URL.split("?")[0];n=n.split("#")[0].toLowerCase();n&&(q+=(q?";":"")+"curl="+n)}catch(p){}try{AdtimaRender.Helpers.Device.browser.facebook&&(q+=(q?";":"")+"fbid=true")}catch(p){}try{if(AdtimaRender.Banner.NativeAd.getZaloSession().zacc_session){q+=(q?";":"")+"iszalo=true"}}catch(p){}if(q){MP3.AD_OVA="vs="+encodeURIComponent(q)}h="http://api.adtimaserver.vn/zad/videoad?zid=1141936321660935238&cid=v_"+MP3.MEDIAID+"&"+MP3.AD_OVA+b}player2=new zPlayer.Player({playlist:c,playerType:"song",height:"366px",width:"650px",autoPlay:true,mute:false,volume:100,alwaysShowControl:false,showPrevButton:l,showNextButton:true,showRepeatSongButton:d,showLevel:true,mimeType:"video/mp4",enableTheaterMode:true,pauseOnClick:true,mp3Url:e.data.item[0].mp3link,suggestions:suggest,product:"zingmp3",poster:{url:c[0].poster,showOnVideoEnd:true},onToggleExpandShrink:function(s){if(s){$("body").addClass("expand");$("body").addClass("user-expand");$("#zplayerjs-wrapper").css("height","550px").css("width","980px");$("#zplayerjs-wrapper").children("div").css("height","550px").css("width","980px");player2.height="550px";player2.width="980px"}else{$("body").removeClass("expand");$("body").removeClass("user-expand");$("#zplayerjs-wrapper").css("height","366px").css("width","650px");$("#zplayerjs-wrapper").children("div").css("height","366px").css("width","650px");player2.height="366px";player2.width="650px"}player2.resize({height:player2.height,width:player2.width});return true},requireVip:function(s){if(typeof ZVip==="object"){ZVip.Fpackage(2)}window.addEventListener("buildUserInfo",function(t){$.getJSON(xml_link,function(v){var x=[];for(var y in v.data.item){var u=v.data.item[y];var z={};z.id=u.id;z.title=u.name;z.song_url=u.mp3link;z.artist=u.artist;z.poster=u.cover!="http://zmp3-photo.d.za.zdn.vn/"?u.cover:"http://image.mp3.zdn.vn/skins/zmp3-v4/images/default2/1190x350.jpg";z.sourceLevel=[];z.source="";for(var y in u.quality){var w={};w.label=u.quality[y].includes("(VIP)")?u.quality[y].replace("(VIP)","p(VIP)"):u.quality[y]+"p";w.source=u.source[y]==="require vip"?"":u.source[y];z.sourceLevel.push(w);if(z.source==""){if(typeof z.sourceLevel!=="undefined"&&typeof z.sourceLevel[0]!=="undefined"){z.source=z.sourceLevel[0].source}}}}x.push(z);console.log("playlistUpdate: ",x)})});return false},ads:{nonInterruptSource:h},});player2.on(zPlayer.Events.PLAYER_READY,function(){media.init();media.listen();media.getListVideoByType();media.getLyricsOfVideo();media.getVideoSuggest();media.getInfoAndDataOfArtist();if(typeof zmp3Like==="object"){zmp3Like.init()}if(typeof zmp3Storage==="object"&&typeof zmp3Storage.getParam("_zpAuto")=="undefined"){zmp3Storage.setParam("_zpAuto",1);$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on");player2.setSongMode(zPlayer.Player.NO_REPEAT_SONG)}if(typeof ZLog==="object"){if(MP3.LOG_INFO==""){var s=setInterval(function(){if(MP3.LOG_INFO!=""){clearInterval(s);MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}},1000)}else{MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}}else{console.log("Undefined Zlog")}});player2.on(zPlayer.Events.PLAYER_UPDATE_SONG_MODE,function(s){if(typeof s==="object"){index=s.playModeSong}else{index=s}if(initModeLoop>=2){if(index==1){$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on");zmp3Storage.setParam("_zpAuto",1)}else{$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off");zmp3Storage.setParam("_zpAuto",0)}}else{if(zmp3Storage.getParam("_zpAuto")==1){$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on")}else{$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off")}}initModeLoop++});player2.on(zPlayer.Events.PLAYER_ENDED,function(){a=false;if(parseInt(zmp3Storage.getParam("playmodesong",0))==1&&parseInt(zmp3Storage.getParam("_zpAuto",0))==1){var t={};if(media.type==="chart"||media.type==="fav"||media.type==="topic"||media.type==="playlist"){if(media.nextPosItem!==""){t.title=$(media.items[media.nextPosItem]).attr("data-title");t.url=$(media.items[media.nextPosItem]).attr("data-url")}else{t.title="";t.url=""}}else{t.title=title;t.url=link}if(t.url!==""){player2.playNext(t)}setTimeout(function(){if(typeof zmp3LogListenFlow==="object"){var u=zmp3LogListenFlow.constants.LOCAL_STORAGE_LISTEN_SONG_BEFORE;zmp3LogListenFlow.updateIsAutoMedia(u,1)}if(t.url!=""&&!a){location.href=t.url}},8000)}if(parseInt(zmp3Storage.getParam("playmodesong",0))==0){if(typeof zmp3LogListenFlow==="object"){var s=zmp3LogListenFlow.constants.LOCAL_STORAGE_LISTEN_SONG_BEFORE;zmp3LogListenFlow.updateIsAutoMedia(s,1)}}});player2.on(zPlayer.Events.PLAYER_PLAYITEM,function(){if(typeof ZLog==="object"){MP3.ZLOG_INFO=MP3.LOG_INFO;ZLog.ZingMp3Log.initLogListen(MP3)}else{console.log("Undefined Zlog")}});player2.on(zPlayer.Events.PLAYER_NEXT,function(s){if(media.type==="chart"||media.type==="fav"||media.type==="topic"||media.type==="playlist"){if(media.nextPosItem!==""){window.location=$(media.items[media.nextPosItem]).attr("data-url")}else{window.location=$(media.items[0]).attr("data-url")}}else{if(link!==""){location.href=link}}});player2.on(zPlayer.Events.PLAYER_PREV,function(s){window.location=$(media.items[media.prevPosItem]).attr("data-url")});player2.on(zPlayer.Events.PLAYER_CANCEL_PLAYNEXT,function(){a=true});player2.attachTo(mp3Element)})}$(".page-play-video").on("click",".fn-autoplay",function(){if(parseInt(zmp3Storage.getParam("_zpAuto",0))==1){$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off");zmp3Storage.setParam("_zpAuto",0)}else{zmp3Storage.setParam("_zpAuto",1);player2.setSongMode(zPlayer.Player.NO_REPEAT_SONG)}})});$(document).on("click",".fn-buy-vip",function(){ZVip.Fpackage(2)});